<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Basic Tactics and Underlying Logic | Chew’s Everyday Blog</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Basic Tactics and Underlying Logic" />
<meta name="author" content="Chew Y. Feng" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="This post explain basic and common tactics in Coq and their underlying logic." />
<meta property="og:description" content="This post explain basic and common tactics in Coq and their underlying logic." />
<link rel="canonical" href="/software-foundations/2023/11/26/tactics.html" />
<meta property="og:url" content="/software-foundations/2023/11/26/tactics.html" />
<meta property="og:site_name" content="Chew’s Everyday Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-11-26T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Basic Tactics and Underlying Logic" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Chew Y. Feng"},"dateModified":"2023-11-28T04:07:52+00:00","datePublished":"2023-11-26T00:00:00+00:00","description":"This post explain basic and common tactics in Coq and their underlying logic.","headline":"Basic Tactics and Underlying Logic","mainEntityOfPage":{"@type":"WebPage","@id":"/software-foundations/2023/11/26/tactics.html"},"url":"/software-foundations/2023/11/26/tactics.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="Chew&apos;s Everyday Blog" /><script>
    // for MathJax inline
    window.MathJax = {
      tex: {
        inlineMath: [['_', '_'], ['$', '$'], ['\\(', '\\)']]
      }
    };
  </script>
  <script type="text/javascript" id="MathJax-script" async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/css-doodle/0.37.4/css-doodle.min.js"></script>
  <link rel="stylesheet"
          href="https://fonts.googleapis.com/css?family=Teko">
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-4TZZDRT6JY"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-4TZZDRT6JY');
  </script>
</head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Chew&#39;s Everyday Blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a><a class="page-link" href="/categories/">Categories</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="page-content-background">
        <css-doodle click-to-update>
          <style>
            @grid: 1 / 100vw 100vh / #0a0c27;
            background-size: 200px 200px;
            background-image: @doodle(
              @grid: 6 / 100%;
              @size: 4px;
              font-size: 4px;
              color: hsl(@r240, 30%, 50%);
              box-shadow: @m3x5(
                calc(4em - @nx * 1em) calc(@ny * 1em)
                  @p(@m3(currentColor), @m2(transparent)),
                calc(2em + @nx * 1em) calc(@ny * 1em)
                  @lp
              );
            );
          </style>
        </css-doodle>
      </div>
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Basic Tactics and Underlying Logic</h1>
    <p class="post-meta"><span class="tags">
        
      </span><time class="dt-published" datetime="2023-11-26T00:00:00+00:00" itemprop="datePublished">
        Posted At: Nov 26, 2023
      </time><time>
        Modified At: Nov 28, 2023
      </time><span class="dt-tags">
        Category:
        
          <span>Software-Foundations</span>
        
      </span></p>
  </header>


  <div class="post-content e-content" itemprop="articleBody">
    <ul id="markdown-toc">
  <li><a href="#make-use-of-lemmas---the-apply-tactic" id="markdown-toc-make-use-of-lemmas---the-apply-tactic">Make use of lemmas - The <code class="language-plaintext highlighter-rouge">apply</code> Tactic</a></li>
  <li><a href="#transitive-relations---the-transitivity-tactic" id="markdown-toc-transitive-relations---the-transitivity-tactic">Transitive Relations - The <code class="language-plaintext highlighter-rouge">transitivity</code> Tactic</a></li>
  <li><a href="#one-to-one-relations---the-injection-tactic" id="markdown-toc-one-to-one-relations---the-injection-tactic">One-to-one Relations - The <code class="language-plaintext highlighter-rouge">injection</code> Tactic</a></li>
  <li><a href="#principle-of-explosion---the-discriminate-tactic" id="markdown-toc-principle-of-explosion---the-discriminate-tactic">Principle of Explosion - The <code class="language-plaintext highlighter-rouge">discriminate</code> tactic</a></li>
  <li><a href="#forward-and-backward-reasoning" id="markdown-toc-forward-and-backward-reasoning">Forward and Backward Reasoning</a></li>
  <li><a href="#specializing-hypothesis---the-specialize-tactic" id="markdown-toc-specializing-hypothesis---the-specialize-tactic">Specializing Hypothesis - The <code class="language-plaintext highlighter-rouge">specialize</code> Tactic</a></li>
  <li><a href="#generalize-induction-hypothesis" id="markdown-toc-generalize-induction-hypothesis">Generalize Induction Hypothesis</a></li>
  <li><a href="#delve-into-expressions---the-unfold-tactic" id="markdown-toc-delve-into-expressions---the-unfold-tactic">Delve into Expressions - The <code class="language-plaintext highlighter-rouge">unfold</code> Tactic</a></li>
  <li><a href="#destruct-on-compound-expressions" id="markdown-toc-destruct-on-compound-expressions">Destruct on Compound Expressions</a></li>
</ul>

<p>This post explain basic and common tactics in Coq and their underlying logic.</p>

<h2 id="make-use-of-lemmas---the-apply-tactic">Make use of lemmas - The <code class="language-plaintext highlighter-rouge">apply</code> Tactic</h2>

<p>The <code class="language-plaintext highlighter-rouge">rewrite</code> tactic is to apply equalities
If you have $H: x = y$ and the goal is $P~x$,  using <code class="language-plaintext highlighter-rouge">rewrite H</code> to change the goal to $P~y$.</p>

<p>On the other hand, the <code class="language-plaintext highlighter-rouge">apply</code> tactic is to apply lemmas.
If you have $L: P \to Q$ and the goal is $Q$,  using <code class="language-plaintext highlighter-rouge">apply L</code> to change the goal to $P$.</p>

<p>Example - use of <code class="language-plaintext highlighter-rouge">apply</code> - (exercise <code class="language-plaintext highlighter-rouge">silly_ex</code>):</p>
<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Theorem</span><span class="w"> </span><span class="no">silly_ex</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">forall</span><span class="w"> </span><span class="no">p</span><span class="o">,</span><span class="w">
  </span><span class="o">(</span><span class="kr">forall</span><span class="w"> </span><span class="no">n</span><span class="o">,</span><span class="w"> </span><span class="no">even</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">even</span><span class="w"> </span><span class="o">(</span><span class="no">S</span><span class="w"> </span><span class="no">n</span><span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">false</span><span class="o">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
  </span><span class="o">(</span><span class="kr">forall</span><span class="w"> </span><span class="no">n</span><span class="o">,</span><span class="w"> </span><span class="no">even</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">false</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">odd</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="o">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
  </span><span class="no">even</span><span class="w"> </span><span class="no">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
  </span><span class="no">odd</span><span class="w"> </span><span class="o">(</span><span class="no">S</span><span class="w"> </span><span class="no">p</span><span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="pi">.</span><span class="w">
</span><span class="k">Proof</span><span class="pi">.</span><span class="w">
  </span><span class="kp">intros</span><span class="w"> </span><span class="no">p</span><span class="w"> </span><span class="no">eq1</span><span class="w"> </span><span class="no">eq2</span><span class="w"> </span><span class="no">eq3</span><span class="pi">.</span><span class="w">
  </span><span class="kp">apply</span><span class="w"> </span><span class="no">eq2</span><span class="pi">.</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">eq1</span><span class="pi">.</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">eq3</span><span class="pi">.</span><span class="w">
  </span><span class="k">Qed</span><span class="pi">.</span><span class="w">
</span></code></pre></div></div>

<p>When we use <code class="language-plaintext highlighter-rouge">apply H</code>, the statement H will begin with a ∀ that introduces some universally quantified variables. Note that to use the apply tactic, the conclusion of the applied-by theorem must be exactly identical to the goal. Therefore, sometimes it is necessary to modified goal to accommodate the theorem. One most simple modification is <code class="language-plaintext highlighter-rouge">symmetry</code> tactic, which switches the left and right sides of an equality in the goal.</p>

<p>Example - use of <code class="language-plaintext highlighter-rouge">symmetry</code> - (exercise <code class="language-plaintext highlighter-rouge">apply_exercise1</code>)</p>
<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Theorem</span><span class="w"> </span><span class="no">rev_exercise1</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">forall</span><span class="w"> </span><span class="o">(</span><span class="no">l</span><span class="w"> </span><span class="no">l'</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">list</span><span class="w"> </span><span class="no">nat</span><span class="o">),</span><span class="w">
  </span><span class="no">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">rev</span><span class="w"> </span><span class="no">l'</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
  </span><span class="no">l'</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">rev</span><span class="w"> </span><span class="no">l</span><span class="pi">.</span><span class="w">
</span><span class="k">Proof</span><span class="pi">.</span><span class="w">
  </span><span class="kp">intros</span><span class="w"> </span><span class="no">l</span><span class="w"> </span><span class="no">l'</span><span class="w"> </span><span class="no">eq1</span><span class="pi">.</span><span class="w">
  </span><span class="kp">rewrite</span><span class="w"> </span><span class="no">eq1</span><span class="pi">.</span><span class="w">
  </span><span class="kp">symmetry</span><span class="pi">.</span><span class="w">
  </span><span class="c">(* [ rev_involutive : forall (X : Type) (l : list X), rev (rev l) = l ] *)</span><span class="w">
  </span><span class="kp">apply</span><span class="w"> </span><span class="no">rev_involutive</span><span class="pi">.</span><span class="w"> 
  </span><span class="k">Qed</span><span class="pi">.</span><span class="w">
</span></code></pre></div></div>

<h2 id="transitive-relations---the-transitivity-tactic">Transitive Relations - The <code class="language-plaintext highlighter-rouge">transitivity</code> Tactic</h2>
<p>Transitivity: If <code class="language-plaintext highlighter-rouge">P a b</code> and <code class="language-plaintext highlighter-rouge">P b c</code> both holds and <code class="language-plaintext highlighter-rouge">P</code> is a transitive property, we can conclude that <code class="language-plaintext highlighter-rouge">P a c</code>.</p>

<p>For example, if we know <code class="language-plaintext highlighter-rouge">6 &gt; 4</code> and <code class="language-plaintext highlighter-rouge">4 &gt; 2</code> and <code class="language-plaintext highlighter-rouge">&gt;</code> is a transitive relation, we are justified to conclude that <code class="language-plaintext highlighter-rouge">6 &gt; 2</code>.</p>

<p>Coq also has a built-in tactic transitivity that accomplishes the same purpose.</p>

<p>Example - use of <code class="language-plaintext highlighter-rouge">transitivity</code> - exercise <code class="language-plaintext highlighter-rouge">trans_eq_exercise</code></p>
<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Example</span><span class="w"> </span><span class="no">trans_eq_exercise</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">forall</span><span class="w"> </span><span class="o">(</span><span class="no">n</span><span class="w"> </span><span class="no">m</span><span class="w"> </span><span class="no">o</span><span class="w"> </span><span class="no">p</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">nat</span><span class="o">),</span><span class="w">
     </span><span class="no">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">(</span><span class="no">minustwo</span><span class="w"> </span><span class="no">o</span><span class="o">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
     </span><span class="o">(</span><span class="no">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="no">p</span><span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">m</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
     </span><span class="o">(</span><span class="no">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="no">p</span><span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">(</span><span class="no">minustwo</span><span class="w"> </span><span class="no">o</span><span class="o">).</span><span class="w">
</span><span class="k">Proof</span><span class="pi">.</span><span class="w">
  </span><span class="kp">intros</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="no">m</span><span class="w"> </span><span class="no">o</span><span class="w"> </span><span class="no">p</span><span class="w"> </span><span class="no">H1</span><span class="w"> </span><span class="no">H2</span><span class="pi">.</span><span class="w">
  </span><span class="kp">transitivity</span><span class="w"> </span><span class="no">m</span><span class="pi">.</span><span class="w">
  </span><span class="kp">apply</span><span class="w"> </span><span class="no">H2</span><span class="pi">.</span><span class="w">
  </span><span class="kp">apply</span><span class="w"> </span><span class="no">H1</span><span class="pi">.</span><span class="w">
  </span><span class="k">Qed</span><span class="pi">.</span><span class="w">
</span></code></pre></div></div>

<p>But Coq does not required the proof of transitivity before using the  <code class="language-plaintext highlighter-rouge">transitivity</code> tactic. It just assumes the transitivity holds. Thus for custom or less standard relations, ensuring and proving their properties, including transitivity, is an important part of constructing correct and meaningful proofs.</p>

<h2 id="one-to-one-relations---the-injection-tactic">One-to-one Relations - The <code class="language-plaintext highlighter-rouge">injection</code> Tactic</h2>
<p>A <em>One-to-one relation</em> - or more formally, an <em>injective relation</em> says that a property of map $f:A\to B$ holds if</p>

\[f(x) = f(y)\]

<p>Then it must be</p>

\[x = y\]

<p>This property is true in all inductively defined type in Coq. So this technique is able to be generalize to every constructor. The corresponding tactic is <code class="language-plaintext highlighter-rouge">injection</code>, which <strong>generates all possible equations from a hypothesis</strong>.</p>

<p>Example - use of <code class="language-plaintext highlighter-rouge">injection</code> - exercise <code class="language-plaintext highlighter-rouge">injection_ex3</code></p>
<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Example</span><span class="w"> </span><span class="no">injection_ex3</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">forall</span><span class="w"> </span><span class="o">(</span><span class="no">X</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">Type</span><span class="o">)</span><span class="w"> </span><span class="o">(</span><span class="no">x</span><span class="w"> </span><span class="no">y</span><span class="w"> </span><span class="no">z</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">X</span><span class="o">)</span><span class="w"> </span><span class="o">(</span><span class="no">l</span><span class="w"> </span><span class="no">j</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">list</span><span class="w"> </span><span class="no">X</span><span class="o">),</span><span class="w">
  </span><span class="no">x</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="no">y</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="no">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">z</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="no">j</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
  </span><span class="no">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">z</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="no">l</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
  </span><span class="no">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">y</span><span class="pi">.</span><span class="w">
</span><span class="k">Proof</span><span class="pi">.</span><span class="w">
  </span><span class="kp">intros</span><span class="w"> </span><span class="no">X</span><span class="w"> </span><span class="no">x</span><span class="w"> </span><span class="no">y</span><span class="w"> </span><span class="no">z</span><span class="w"> </span><span class="no">l</span><span class="w"> </span><span class="no">j</span><span class="w"> </span><span class="no">H0</span><span class="w"> </span><span class="no">H1</span><span class="pi">.</span><span class="w">
  </span><span class="kp">injection</span><span class="w"> </span><span class="no">H0</span><span class="pi">.</span><span class="w">
  </span><span class="kp">intros</span><span class="w"> </span><span class="no">H0a</span><span class="w"> </span><span class="no">H0b</span><span class="pi">.</span><span class="w">
  </span><span class="no">assert</span><span class="w"> </span><span class="o">(</span><span class="w"> </span><span class="no">H2</span><span class="p">:</span><span class="w"> </span><span class="no">y</span><span class="p">::</span><span class="no">l</span><span class="o">=</span><span class="no">z</span><span class="p">::</span><span class="no">l</span><span class="w"> </span><span class="o">).</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="kp">rewrite</span><span class="w"> </span><span class="no">H0a</span><span class="pi">.</span><span class="w"> </span><span class="kp">rewrite</span><span class="w"> </span><span class="no">H1</span><span class="pi">.</span><span class="w"> </span><span class="ne">reflexivity</span><span class="pi">.</span><span class="w">  </span><span class="o">}</span><span class="w">
  </span><span class="kp">injection</span><span class="w"> </span><span class="no">H2</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="no">H2i</span><span class="pi">.</span><span class="w">
  </span><span class="kp">rewrite</span><span class="w"> </span><span class="no">H2i</span><span class="pi">.</span><span class="w"> </span><span class="kp">rewrite</span><span class="w"> </span><span class="no">H0b</span><span class="pi">.</span><span class="w">
  </span><span class="ne">reflexivity</span><span class="pi">.</span><span class="w">
  </span><span class="k">Qed</span><span class="pi">.</span><span class="w">
</span></code></pre></div></div>

<p>We can also make use of injective relations directedly on functions in the goal. Coq provides <code class="language-plaintext highlighter-rouge">f_equal</code> tactic to perform simplification based on assumption that the relation is injective.</p>

<p>Example - <code class="language-plaintext highlighter-rouge">eq_implies_succ_equal</code></p>
<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Theorem</span><span class="w"> </span><span class="no">eq_implies_succ_equal'</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">forall</span><span class="w"> </span><span class="o">(</span><span class="no">n</span><span class="w"> </span><span class="no">m</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">nat</span><span class="o">),</span><span class="w">
  </span><span class="no">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">m</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">S</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">S</span><span class="w"> </span><span class="no">m</span><span class="pi">.</span><span class="w">
</span><span class="k">Proof</span><span class="pi">.</span><span class="w"> </span><span class="kp">intros</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="no">m</span><span class="w"> </span><span class="no">H</span><span class="pi">.</span><span class="w"> </span><span class="kp">f_equal</span><span class="pi">.</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">H</span><span class="pi">.</span><span class="w"> </span><span class="k">Qed</span><span class="pi">.</span><span class="w">
</span></code></pre></div></div>
<p>It is observed that <code class="language-plaintext highlighter-rouge">S n = S m</code> is immediately be simplified to <code class="language-plaintext highlighter-rouge">n = m</code> after using the <code class="language-plaintext highlighter-rouge">f_equal</code> tactic.</p>
<h2 id="principle-of-explosion---the-discriminate-tactic">Principle of Explosion - The <code class="language-plaintext highlighter-rouge">discriminate</code> tactic</h2>
<p>The principle of explosion is also known as <em>ex falso</em> - in Latin “from falsehood, anything (follows)” - which is the law according to which any statement can be proven from a contradiction in logic systems.</p>

<p>In Coq, every inductively defined type has $disjoint$ constructors. For example, the <code class="language-plaintext highlighter-rouge">nat</code> type has  two disjoint constructors: <code class="language-plaintext highlighter-rouge">S nat</code> and <code class="language-plaintext highlighter-rouge">O</code>, in which any two terms with different constructors can never be equal. In the context that we assume such two terms are equal, we are justified to prove anything we want.</p>

<p>The quote is from the software foundations, which explains the reason why we can do this, which I can’t really find a better explanation that it.</p>

<blockquote>
  <p>If you find the principle of explosion confusing, remember that these proofs are <em>not</em> showing that the conclusion of the statement holds. Rather, they are showing that, <em>if</em> the nonsensical situation described by the premise did somehow hold, <em>then</em> the nonsensical conclusion would also follow, because we’d be living in an inconsistent universe where every statement is true.</p>
</blockquote>

<p>The <code class="language-plaintext highlighter-rouge">discriminate</code> tactic can be use when the goal is a contradiction that wants us to prove two terms with different constructors are the same.</p>

<p>Example - use of <code class="language-plaintext highlighter-rouge">discriminate</code> - exercise <code class="language-plaintext highlighter-rouge">injection_ex3</code></p>
<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Example</span><span class="w"> </span><span class="no">discriminate_ex3</span><span class="w"> </span><span class="p">:</span><span class="w">
  </span><span class="kr">forall</span><span class="w"> </span><span class="o">(</span><span class="no">X</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">Type</span><span class="o">)</span><span class="w"> </span><span class="o">(</span><span class="no">x</span><span class="w"> </span><span class="no">y</span><span class="w"> </span><span class="no">z</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">X</span><span class="o">)</span><span class="w"> </span><span class="o">(</span><span class="no">l</span><span class="w"> </span><span class="no">j</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">list</span><span class="w"> </span><span class="no">X</span><span class="o">),</span><span class="w">
    </span><span class="no">x</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="no">y</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="no">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
    </span><span class="no">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">z</span><span class="pi">.</span><span class="w">
</span><span class="k">Proof</span><span class="pi">.</span><span class="w">
  </span><span class="kp">intros</span><span class="w"> </span><span class="no">X</span><span class="w"> </span><span class="no">x</span><span class="w"> </span><span class="no">t</span><span class="w"> </span><span class="no">z</span><span class="w"> </span><span class="no">l</span><span class="w"> </span><span class="no">j</span><span class="w"> </span><span class="no">contrast</span><span class="pi">.</span><span class="w">
  </span><span class="no">discriminate</span><span class="w"> </span><span class="no">contrast</span><span class="pi">.</span><span class="w"> </span><span class="k">Qed</span><span class="pi">.</span><span class="w">
</span></code></pre></div></div>

<p>This example is trivial - a theorem built on a contradiction is not practically useful - but it shows that we can develop any bullshit given a nonsensical premise. It is more useful in branches produced by <code class="language-plaintext highlighter-rouge">destruct</code> of <code class="language-plaintext highlighter-rouge">induction</code> of some proof, in which we can just use discriminate to say “<strong>This branch is impossible to stand so we can skip it</strong>”.</p>

<h2 id="forward-and-backward-reasoning">Forward and Backward Reasoning</h2>
<p>Forward reasoning starts from what we know and iteratively push forward until the goal is reached. Informal proofs seen in math and CS classes are often presented in this style. 
Conversely, backward reasoning begins from the goal that we want to proof, iteratively transform it to what we already know. This is the default style in Coq.</p>

<p>It is not necessarily to say one way is better than the other, and we are able to combine them as our tools to draw a reasonable and intuitive conclusion. To employ forward reasoning, we can use the <code class="language-plaintext highlighter-rouge">in</code> clause:</p>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Theorem</span><span class="w"> </span><span class="no">S_inj</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">forall</span><span class="w"> </span><span class="o">(</span><span class="no">n</span><span class="w"> </span><span class="no">m</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">nat</span><span class="o">)</span><span class="w"> </span><span class="o">(</span><span class="no">b</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">bool</span><span class="o">),</span><span class="w">
  </span><span class="o">((</span><span class="no">S</span><span class="w"> </span><span class="no">n</span><span class="o">)</span><span class="w"> </span><span class="o">=?</span><span class="w"> </span><span class="o">(</span><span class="no">S</span><span class="w"> </span><span class="no">m</span><span class="o">))</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">b</span><span class="w">  </span><span class="o">-&gt;</span><span class="w">
  </span><span class="o">(</span><span class="no">n</span><span class="w"> </span><span class="o">=?</span><span class="w"> </span><span class="no">m</span><span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">b</span><span class="pi">.</span><span class="w">
</span><span class="k">Proof</span><span class="pi">.</span><span class="w">
  </span><span class="kp">intros</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="no">m</span><span class="w"> </span><span class="no">b</span><span class="w"> </span><span class="no">H</span><span class="pi">.</span><span class="w"> </span><span class="kp">simpl</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="no">H</span><span class="pi">.</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">H</span><span class="pi">.</span><span class="w">  </span><span class="k">Qed</span><span class="pi">.</span><span class="w">
</span></code></pre></div></div>

<p>The line <code class="language-plaintext highlighter-rouge">simpl in H.</code> transform H from</p>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">(</span><span class="no">S</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="o">=?</span><span class="w"> </span><span class="no">S</span><span class="w"> </span><span class="no">m</span><span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">b</span><span class="w">
</span></code></pre></div></div>

<p>to</p>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">(</span><span class="no">n</span><span class="w"> </span><span class="o">=?</span><span class="w"> </span><span class="no">m</span><span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">b</span><span class="w">
</span></code></pre></div></div>

<p>By the definition of <code class="language-plaintext highlighter-rouge">=?</code> (eqb) operator.</p>

<p>Similarly, it is also acceptable to use other tactics on hypothesis such as <code class="language-plaintext highlighter-rouge">symmetry in H</code>, <code class="language-plaintext highlighter-rouge">apply lemma1 in H</code> and more. Just follow the same rule as what we have done on the goal.</p>

<h2 id="specializing-hypothesis---the-specialize-tactic">Specializing Hypothesis - The <code class="language-plaintext highlighter-rouge">specialize</code> Tactic</h2>

<p>Hypothesis with $\forall$ quantifiers can be specialize to what we want it to be.</p>
<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Example</span><span class="w"> </span><span class="no">trans_eq_example'''</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">forall</span><span class="w"> </span><span class="o">(</span><span class="no">a</span><span class="w"> </span><span class="no">b</span><span class="w"> </span><span class="no">c</span><span class="w"> </span><span class="no">d</span><span class="w"> </span><span class="no">e</span><span class="w"> </span><span class="no">f</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">nat</span><span class="o">),</span><span class="w">
     </span><span class="o">[</span><span class="no">a</span><span class="p">;</span><span class="no">b</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="no">c</span><span class="p">;</span><span class="no">d</span><span class="o">]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
     </span><span class="o">[</span><span class="no">c</span><span class="p">;</span><span class="no">d</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="no">e</span><span class="p">;</span><span class="no">f</span><span class="o">]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
     </span><span class="o">[</span><span class="no">a</span><span class="p">;</span><span class="no">b</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="no">e</span><span class="p">;</span><span class="no">f</span><span class="o">].</span><span class="w">
</span><span class="k">Proof</span><span class="pi">.</span><span class="w">
  </span><span class="kp">intros</span><span class="w"> </span><span class="no">a</span><span class="w"> </span><span class="no">b</span><span class="w"> </span><span class="no">c</span><span class="w"> </span><span class="no">d</span><span class="w"> </span><span class="no">e</span><span class="w"> </span><span class="no">f</span><span class="w"> </span><span class="no">eq1</span><span class="w"> </span><span class="no">eq2</span><span class="pi">.</span><span class="w">
  </span><span class="c">(* trans_eq: forall X (n m o : X), n = m -&gt; m = o -&gt; n = o *)</span><span class="w">
  </span><span class="kp">specialize</span><span class="w"> </span><span class="no">trans_eq</span><span class="w"> </span><span class="kp">with</span><span class="w"> </span><span class="o">(</span><span class="no">m</span><span class="p">:</span><span class="o">=[</span><span class="no">c</span><span class="p">;</span><span class="no">d</span><span class="o">])</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="no">H</span><span class="pi">.</span><span class="w">
  </span><span class="kp">apply</span><span class="w"> </span><span class="no">H</span><span class="pi">.</span><span class="w">
  </span><span class="kp">apply</span><span class="w"> </span><span class="no">eq1</span><span class="pi">.</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">eq2</span><span class="pi">.</span><span class="w"> 
</span><span class="k">Qed</span><span class="pi">.</span><span class="w">
</span></code></pre></div></div>

<p>We explicitly specialize a general lemma <code class="language-plaintext highlighter-rouge">trans_eq</code> to a specific lemma that accommodates the goal with the name <code class="language-plaintext highlighter-rouge">H</code>:</p>
<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">H</span><span class="p">:</span><span class="w"> </span><span class="kr">forall</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="no">o</span><span class="o">,</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="no">c</span><span class="p">;</span><span class="w"> </span><span class="no">d</span><span class="o">]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">[</span><span class="no">c</span><span class="p">;</span><span class="w"> </span><span class="no">d</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">o</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">o</span><span class="w">
</span></code></pre></div></div>

<p>The example shows specialization form a global theorem. Note that we can specialize local hypothesis as well.</p>

<h2 id="generalize-induction-hypothesis">Generalize Induction Hypothesis</h2>
<p>Sometimes it is important to control the form of the induction hypothesis. To be more specific, when there are multiple variables, it is not necessary to introduce all variables from the goal to the context. Instead, we may find it convenient to let them stay in the context so that the hypothesis can be more general.</p>

<p>Example - general induction - exercise <code class="language-plaintext highlighter-rouge">eqb_true</code></p>
<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Theorem</span><span class="w"> </span><span class="no">eqb_true</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">forall</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="no">m</span><span class="o">,</span><span class="w">
  </span><span class="no">n</span><span class="w"> </span><span class="o">=?</span><span class="w"> </span><span class="no">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">m</span><span class="pi">.</span><span class="w">
</span><span class="k">Proof</span><span class="pi">.</span><span class="w">
  </span><span class="kp">intros</span><span class="w"> </span><span class="no">n</span><span class="pi">.</span><span class="w"> </span><span class="kp">induction</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="o">[|</span><span class="w"> </span><span class="no">n'</span><span class="w"> </span><span class="no">IHn</span><span class="o">].</span><span class="w">
  </span><span class="o">-</span><span class="w"> </span><span class="kp">intros</span><span class="w"> </span><span class="no">m</span><span class="w"> </span><span class="no">eq</span><span class="pi">.</span><span class="w"> </span><span class="kp">destruct</span><span class="w"> </span><span class="no">m</span><span class="pi">.</span><span class="w">
    </span><span class="o">+</span><span class="w"> </span><span class="ne">reflexivity</span><span class="pi">.</span><span class="w">
    </span><span class="o">+</span><span class="w"> </span><span class="no">discriminate</span><span class="pi">.</span><span class="w"> 
  </span><span class="o">-</span><span class="w"> </span><span class="kp">intros</span><span class="w"> </span><span class="no">m</span><span class="w"> </span><span class="no">eq</span><span class="pi">.</span><span class="w"> </span><span class="kp">destruct</span><span class="w"> </span><span class="no">m</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="o">[|</span><span class="w"> </span><span class="no">m'</span><span class="o">].</span><span class="w">
    </span><span class="o">+</span><span class="w"> </span><span class="no">discriminate</span><span class="pi">.</span><span class="w">
    </span><span class="o">+</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">eq_implies_succ_equal</span><span class="pi">.</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">IHn</span><span class="pi">.</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">eq</span><span class="pi">.</span><span class="w"> 
</span><span class="k">Qed</span><span class="pi">.</span><span class="w">
</span></code></pre></div></div>

<p>In this example, it is only <code class="language-plaintext highlighter-rouge">n</code> in the context the induction, so that we get a hypothesis:</p>
<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">IHn</span><span class="p">:</span><span class="w"> </span><span class="kr">forall</span><span class="w"> </span><span class="no">m</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">nat</span><span class="o">,</span><span class="w"> </span><span class="o">(</span><span class="no">n'</span><span class="w"> </span><span class="o">=?</span><span class="w"> </span><span class="no">m</span><span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">n'</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">m</span><span class="w">
</span></code></pre></div></div>

<p>Not that the <code class="language-plaintext highlighter-rouge">m</code> in <code class="language-plaintext highlighter-rouge">IHn</code> is a general variable with a $\forall$ quantifier, which is not the same with <code class="language-plaintext highlighter-rouge">m</code> in the theorem declaration. In practice, <code class="language-plaintext highlighter-rouge">m</code> can be specialized to any other <code class="language-plaintext highlighter-rouge">nat</code>. i.e. <code class="language-plaintext highlighter-rouge">S m</code></p>

<p>Another useful example to illustrate this idea:</p>

<p>Example - exercise <code class="language-plaintext highlighter-rouge">plus_n_n_injective</code></p>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Theorem</span><span class="w"> </span><span class="no">plus_n_n_injective</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">forall</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="no">m</span><span class="o">,</span><span class="w">
  </span><span class="no">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">m</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="no">m</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
  </span><span class="no">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">m</span><span class="pi">.</span><span class="w">
</span><span class="k">Proof</span><span class="pi">.</span><span class="w">
  </span><span class="kp">intros</span><span class="w"> </span><span class="no">n</span><span class="pi">.</span><span class="w"> </span><span class="kp">induction</span><span class="w"> </span><span class="no">n</span><span class="pi">.</span><span class="w">
  </span><span class="o">-</span><span class="w"> </span><span class="kp">simpl</span><span class="pi">.</span><span class="w"> </span><span class="kp">intros</span><span class="w"> </span><span class="no">m</span><span class="w"> </span><span class="no">H</span><span class="pi">.</span><span class="w"> </span><span class="kp">destruct</span><span class="w"> </span><span class="no">m</span><span class="pi">.</span><span class="w">
    </span><span class="o">+</span><span class="w"> </span><span class="ne">reflexivity</span><span class="pi">.</span><span class="w">
    </span><span class="o">+</span><span class="w"> </span><span class="no">discriminate</span><span class="pi">.</span><span class="w">
  </span><span class="o">-</span><span class="w"> </span><span class="kp">intros</span><span class="w"> </span><span class="no">m</span><span class="w"> </span><span class="no">H</span><span class="pi">.</span><span class="w"> </span><span class="kp">destruct</span><span class="w"> </span><span class="no">m</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="o">[|</span><span class="w"> </span><span class="no">m'</span><span class="o">].</span><span class="w">
    </span><span class="o">+</span><span class="w"> </span><span class="no">discriminate</span><span class="pi">.</span><span class="w">
    </span><span class="o">+</span><span class="w"> </span><span class="kp">simpl</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="no">H</span><span class="pi">.</span><span class="w"> 
      </span><span class="kp">rewrite</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="no">plus_n_Sm</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="no">H</span><span class="pi">.</span><span class="w">
      </span><span class="kp">rewrite</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="no">plus_n_Sm</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="no">H</span><span class="pi">.</span><span class="w">
      </span><span class="kp">injection</span><span class="w"> </span><span class="no">H</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="no">H'</span><span class="pi">.</span><span class="w">
      </span><span class="kp">apply</span><span class="w"> </span><span class="no">IHn</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="no">H'</span><span class="pi">.</span><span class="w">
      </span><span class="kp">f_equal</span><span class="pi">.</span><span class="w">
      </span><span class="kp">apply</span><span class="w"> </span><span class="no">H'</span><span class="pi">.</span><span class="w">
  </span><span class="k">Qed</span><span class="pi">.</span><span class="w">
</span></code></pre></div></div>

<p>Sometimes the order of variables in the theorem declaration cannot achieve what we want just like the example above - keep m in the goal while introduce n to the context - we can use <code class="language-plaintext highlighter-rouge">generalize</code> tactic to re-generalize some variables.</p>

<p>Example - use of <code class="language-plaintext highlighter-rouge">generalize</code> - exercise <code class="language-plaintext highlighter-rouge">gen_dep_practice</code>.</p>
<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Lemma</span><span class="w"> </span><span class="no">length_0_empty</span><span class="p">:</span><span class="w"> </span><span class="kr">forall</span><span class="w"> </span><span class="o">(</span><span class="no">X</span><span class="p">:</span><span class="w"> </span><span class="kr">Type</span><span class="o">)</span><span class="w"> </span><span class="o">(</span><span class="no">l</span><span class="p">:</span><span class="w"> </span><span class="no">list</span><span class="w"> </span><span class="no">X</span><span class="o">),</span><span class="w"> 
	</span><span class="no">length</span><span class="w"> </span><span class="no">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">nil</span><span class="pi">.</span><span class="w">
</span><span class="k">Proof</span><span class="pi">.</span><span class="w">
  </span><span class="kp">intros</span><span class="pi">.</span><span class="w"> </span><span class="kp">destruct</span><span class="w"> </span><span class="no">l</span><span class="pi">.</span><span class="w"> </span><span class="ne">reflexivity</span><span class="pi">.</span><span class="w"> </span><span class="no">discriminate</span><span class="pi">.</span><span class="w"> 
</span><span class="k">Qed</span><span class="pi">.</span><span class="w">

</span><span class="k">Theorem</span><span class="w"> </span><span class="no">nth_error_after_last</span><span class="p">:</span><span class="w"> </span><span class="kr">forall</span><span class="w"> </span><span class="o">(</span><span class="no">n</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">nat</span><span class="o">)</span><span class="w"> </span><span class="o">(</span><span class="no">X</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">Type</span><span class="o">)</span><span class="w"> </span><span class="o">(</span><span class="no">l</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">list</span><span class="w"> </span><span class="no">X</span><span class="o">),</span><span class="w">
  </span><span class="no">length</span><span class="w"> </span><span class="no">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
  </span><span class="no">nth_error</span><span class="w"> </span><span class="no">l</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">None</span><span class="pi">.</span><span class="w">
</span><span class="k">Proof</span><span class="pi">.</span><span class="w">
  </span><span class="kp">intros</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="no">X</span><span class="w"> </span><span class="no">l</span><span class="pi">.</span><span class="w"> </span><span class="kp">generalize</span><span class="w"> </span><span class="no">n</span><span class="pi">.</span><span class="w">
  </span><span class="kp">induction</span><span class="w"> </span><span class="no">l</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="o">[|</span><span class="w"> </span><span class="no">x</span><span class="w"> </span><span class="no">l'</span><span class="w"> </span><span class="no">IHl</span><span class="o">].</span><span class="w">
  </span><span class="o">-</span><span class="w"> </span><span class="kp">simpl</span><span class="pi">.</span><span class="w"> </span><span class="ne">reflexivity</span><span class="pi">.</span><span class="w">
  </span><span class="o">-</span><span class="w"> </span><span class="kp">intros</span><span class="w"> </span><span class="no">n'</span><span class="w"> </span><span class="no">eq</span><span class="pi">.</span><span class="w"> </span><span class="kp">destruct</span><span class="w"> </span><span class="no">n'</span><span class="pi">.</span><span class="w">
    </span><span class="o">+</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">length_0_empty</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="no">eq</span><span class="pi">.</span><span class="w"> </span><span class="kp">rewrite</span><span class="w"> </span><span class="no">eq</span><span class="pi">.</span><span class="w"> </span><span class="ne">reflexivity</span><span class="pi">.</span><span class="w">
    </span><span class="o">+</span><span class="w"> </span><span class="kp">simpl</span><span class="pi">.</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">IHl</span><span class="pi">.</span><span class="w"> </span><span class="kp">simpl</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="no">eq</span><span class="pi">.</span><span class="w"> </span><span class="kp">injection</span><span class="w"> </span><span class="no">eq</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="no">eq1</span><span class="pi">.</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">eq1</span><span class="pi">.</span><span class="w">
</span><span class="k">Qed</span><span class="pi">.</span><span class="w">
</span></code></pre></div></div>

<h2 id="delve-into-expressions---the-unfold-tactic">Delve into Expressions - The <code class="language-plaintext highlighter-rouge">unfold</code> Tactic</h2>
<p>The <code class="language-plaintext highlighter-rouge">unfold</code> tactic tells Coq to replace the expression by their definition. It is a rather straightforward tactic that “evaluates” an expression.</p>

<p>Sometime <code class="language-plaintext highlighter-rouge">simpl</code> will also perform an unfolding if the function is not too complicated. In this case, we need to use <code class="language-plaintext highlighter-rouge">unfold</code> to encourage Coq to do so.</p>

<p>Example:</p>
<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Definition</span><span class="w"> </span><span class="no">bar</span><span class="w"> </span><span class="no">x</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w">
  </span><span class="kr">match</span><span class="w"> </span><span class="no">x</span><span class="w"> </span><span class="kp">with</span><span class="w">
  </span><span class="o">|</span><span class="w"> </span><span class="no">O</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="mi">5</span><span class="w">
  </span><span class="o">|</span><span class="w"> </span><span class="no">S</span><span class="w"> </span><span class="p">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="mi">5</span><span class="w">
  </span><span class="kr">end</span><span class="pi">.</span><span class="w">

</span><span class="no">Fact</span><span class="w"> </span><span class="no">silly_fact_2'</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">forall</span><span class="w"> </span><span class="no">m</span><span class="o">,</span><span class="w"> </span><span class="no">bar</span><span class="w"> </span><span class="no">m</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">bar</span><span class="w"> </span><span class="o">(</span><span class="no">m</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="o">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="o">.</span><span class="w">
</span><span class="k">Proof</span><span class="pi">.</span><span class="w">
  </span><span class="kp">intros</span><span class="w"> </span><span class="no">m</span><span class="pi">.</span><span class="w">
  </span><span class="kp">unfold</span><span class="w"> </span><span class="no">bar</span><span class="pi">.</span><span class="w">
  </span><span class="kp">destruct</span><span class="w"> </span><span class="no">m</span><span class="w"> </span><span class="no">eqn</span><span class="p">:</span><span class="no">E</span><span class="pi">.</span><span class="w">
  </span><span class="o">-</span><span class="w"> </span><span class="ne">reflexivity</span><span class="pi">.</span><span class="w">
  </span><span class="o">-</span><span class="w"> </span><span class="ne">reflexivity</span><span class="pi">.</span><span class="w">
</span><span class="k">Qed</span><span class="pi">.</span><span class="w">
</span></code></pre></div></div>
<h2 id="destruct-on-compound-expressions">Destruct on Compound Expressions</h2>
<p>When we are reasoning a function, especially after unfolding, sometime it is needed to perform case analysis as well. Especially there is no existing lemmas can be employ. In this case, we might need to look at the <code class="language-plaintext highlighter-rouge">if..else</code> branches one-by-one. To do that, we can use <code class="language-plaintext highlighter-rouge">destruct</code> on expressions.</p>

<p>Example</p>
<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Definition</span><span class="w"> </span><span class="no">sillyfun</span><span class="w"> </span><span class="o">(</span><span class="no">n</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">nat</span><span class="o">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">bool</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w">
  </span><span class="kr">if</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="o">=?</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="no">false</span><span class="w">
  </span><span class="kr">else</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="o">=?</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="no">false</span><span class="w">
  </span><span class="kr">else</span><span class="w"> </span><span class="no">false</span><span class="pi">.</span><span class="w">

</span><span class="k">Theorem</span><span class="w"> </span><span class="no">sillyfun_false</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">forall</span><span class="w"> </span><span class="o">(</span><span class="no">n</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">nat</span><span class="o">),</span><span class="w">
  </span><span class="no">sillyfun</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">false</span><span class="pi">.</span><span class="w">
</span><span class="k">Proof</span><span class="pi">.</span><span class="w">
  </span><span class="kp">intros</span><span class="w"> </span><span class="no">n</span><span class="pi">.</span><span class="w"> </span><span class="kp">unfold</span><span class="w"> </span><span class="no">sillyfun</span><span class="pi">.</span><span class="w">
  </span><span class="kp">destruct</span><span class="w"> </span><span class="o">(</span><span class="no">n</span><span class="w"> </span><span class="o">=?</span><span class="w"> </span><span class="mi">3</span><span class="o">)</span><span class="w"> </span><span class="no">eqn</span><span class="p">:</span><span class="no">E1</span><span class="pi">.</span><span class="w">
    </span><span class="o">-</span><span class="w"> </span><span class="c">(* n =? 3 = true *)</span><span class="w"> </span><span class="ne">reflexivity</span><span class="pi">.</span><span class="w">
    </span><span class="o">-</span><span class="w"> </span><span class="c">(* n =? 3 = false *)</span><span class="w"> </span><span class="kp">destruct</span><span class="w"> </span><span class="o">(</span><span class="no">n</span><span class="w"> </span><span class="o">=?</span><span class="w"> </span><span class="mi">5</span><span class="o">)</span><span class="w"> </span><span class="no">eqn</span><span class="p">:</span><span class="no">E2</span><span class="pi">.</span><span class="w">
      </span><span class="o">+</span><span class="w"> </span><span class="c">(* n =? 5 = true *)</span><span class="w"> </span><span class="ne">reflexivity</span><span class="pi">.</span><span class="w">
      </span><span class="o">+</span><span class="w"> </span><span class="c">(* n =? 5 = false *)</span><span class="w"> </span><span class="ne">reflexivity</span><span class="pi">.</span><span class="w">  </span><span class="k">Qed</span><span class="pi">.</span><span class="w">
</span></code></pre></div></div>
<p>The <code class="language-plaintext highlighter-rouge">sillyfun_false</code> theorem declares a property which tells the function <code class="language-plaintext highlighter-rouge">sillyfun</code> always returns false. It looks at every branches by <code class="language-plaintext highlighter-rouge">destruct</code> the predicate expression.</p>

<p>A more meaningful example is from the exercise:
Example - exercise <code class="language-plaintext highlighter-rouge">combine_split</code>:</p>
<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Fixpoint</span><span class="w"> </span><span class="kp">split</span><span class="w"> </span><span class="o">{</span><span class="no">X</span><span class="w"> </span><span class="no">Y</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">Type</span><span class="o">}</span><span class="w"> </span><span class="o">(</span><span class="no">l</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">list</span><span class="w"> </span><span class="o">(</span><span class="no">X</span><span class="o">*</span><span class="no">Y</span><span class="o">))</span><span class="w">
               </span><span class="p">:</span><span class="w"> </span><span class="o">(</span><span class="no">list</span><span class="w"> </span><span class="no">X</span><span class="o">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="o">(</span><span class="no">list</span><span class="w"> </span><span class="no">Y</span><span class="o">)</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w">
  </span><span class="kr">match</span><span class="w"> </span><span class="no">l</span><span class="w"> </span><span class="kp">with</span><span class="w">
  </span><span class="o">|</span><span class="w"> </span><span class="o">[]</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">([],</span><span class="w"> </span><span class="o">[])</span><span class="w">
  </span><span class="o">|</span><span class="w"> </span><span class="o">(</span><span class="no">x</span><span class="o">,</span><span class="w"> </span><span class="no">y</span><span class="o">)</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="no">t</span><span class="w"> </span><span class="o">=&gt;</span><span class="w">
      </span><span class="kr">match</span><span class="w"> </span><span class="kp">split</span><span class="w"> </span><span class="no">t</span><span class="w"> </span><span class="kp">with</span><span class="w">
      </span><span class="o">|</span><span class="w"> </span><span class="o">(</span><span class="no">lx</span><span class="o">,</span><span class="w"> </span><span class="no">ly</span><span class="o">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">(</span><span class="no">x</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="no">lx</span><span class="o">,</span><span class="w"> </span><span class="no">y</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="no">ly</span><span class="o">)</span><span class="w">
      </span><span class="kr">end</span><span class="w">
  </span><span class="kr">end</span><span class="pi">.</span><span class="w">

</span><span class="c">(** Prove that [split] and [combine] are inverses in the following
    sense: *)</span><span class="w">

</span><span class="k">Theorem</span><span class="w"> </span><span class="no">combine_split</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">forall</span><span class="w"> </span><span class="no">X</span><span class="w"> </span><span class="no">Y</span><span class="w"> </span><span class="o">(</span><span class="no">l</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">list</span><span class="w"> </span><span class="o">(</span><span class="no">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="no">Y</span><span class="o">))</span><span class="w"> </span><span class="no">l1</span><span class="w"> </span><span class="no">l2</span><span class="o">,</span><span class="w">
  </span><span class="kp">split</span><span class="w"> </span><span class="no">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">(</span><span class="no">l1</span><span class="o">,</span><span class="w"> </span><span class="no">l2</span><span class="o">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
  </span><span class="no">combine</span><span class="w"> </span><span class="no">l1</span><span class="w"> </span><span class="no">l2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">l</span><span class="pi">.</span><span class="w">
</span><span class="k">Proof</span><span class="pi">.</span><span class="w">
  </span><span class="kp">intros</span><span class="w"> </span><span class="no">X</span><span class="w"> </span><span class="no">Y</span><span class="w"> </span><span class="no">l</span><span class="pi">.</span><span class="w">
  </span><span class="kp">induction</span><span class="w"> </span><span class="no">l</span><span class="pi">.</span><span class="w"> 
  </span><span class="o">-</span><span class="w"> </span><span class="kp">simpl</span><span class="pi">.</span><span class="w"> </span><span class="kp">intros</span><span class="pi">.</span><span class="w"> 
    </span><span class="kp">injection</span><span class="w"> </span><span class="no">H</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="no">H1</span><span class="w"> </span><span class="no">H2</span><span class="pi">.</span><span class="w"> 
    </span><span class="kp">rewrite</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="no">H1</span><span class="pi">.</span><span class="w"> </span><span class="kp">rewrite</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="no">H2</span><span class="pi">.</span><span class="w"> 
    </span><span class="ne">reflexivity</span><span class="pi">.</span><span class="w">
  </span><span class="o">-</span><span class="w"> </span><span class="kp">destruct</span><span class="w"> </span><span class="no">x</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="o">[</span><span class="no">x1</span><span class="w"> </span><span class="no">x2</span><span class="o">].</span><span class="w"> </span><span class="kp">simpl</span><span class="pi">.</span><span class="w"> </span><span class="kp">destruct</span><span class="w"> </span><span class="o">(</span><span class="kp">split</span><span class="w"> </span><span class="no">l</span><span class="o">)</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="o">[</span><span class="no">lx</span><span class="w"> </span><span class="no">ly</span><span class="o">].</span><span class="w">
    </span><span class="kp">intros</span><span class="pi">.</span><span class="w"> </span><span class="kp">injection</span><span class="w"> </span><span class="no">H</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="no">H1</span><span class="w"> </span><span class="no">H2</span><span class="pi">.</span><span class="w"> 
    </span><span class="kp">rewrite</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="no">H1</span><span class="pi">.</span><span class="w">
    </span><span class="kp">rewrite</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="no">H2</span><span class="pi">.</span><span class="w">
    </span><span class="kp">simpl</span><span class="pi">.</span><span class="w"> </span><span class="kp">rewrite</span><span class="w"> </span><span class="no">IHl</span><span class="pi">.</span><span class="w"> </span><span class="ne">reflexivity</span><span class="pi">.</span><span class="w"> </span><span class="ne">reflexivity</span><span class="pi">.</span><span class="w">
</span><span class="k">Qed</span><span class="pi">.</span><span class="w">
</span></code></pre></div></div>
<p>In this example, the destruct only produce one subgoal since the <code class="language-plaintext highlighter-rouge">split l</code> pattern match in the definition of <code class="language-plaintext highlighter-rouge">split</code> only has one branch. But it moves forward from</p>
<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">match</span><span class="w"> </span><span class="kp">split</span><span class="w"> </span><span class="no">l</span><span class="w"> </span><span class="kp">with</span><span class="w">
</span><span class="o">|</span><span class="w"> </span><span class="o">(</span><span class="no">lx</span><span class="o">,</span><span class="w"> </span><span class="no">ly</span><span class="o">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">(</span><span class="no">x1</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="no">lx</span><span class="o">,</span><span class="w"> </span><span class="no">x2</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="no">ly</span><span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">(</span><span class="no">l1</span><span class="w"> </span><span class="no">l2</span><span class="o">)</span><span class="w">
</span><span class="kr">end</span><span class="w">
</span></code></pre></div></div>
<p>to</p>
<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">(</span><span class="no">x1</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="no">lx</span><span class="o">,</span><span class="w"> </span><span class="no">x2</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="no">ly</span><span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">(</span><span class="no">l1</span><span class="o">,</span><span class="w"> </span><span class="no">l2</span><span class="o">)</span><span class="w">
</span></code></pre></div></div>
<p>which is still a meaningful step in the proof.</p>

  </div><a class="u-url" href="/software-foundations/2023/11/26/tactics.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    
    <div class="footer-col-wrapper">
      <div class="footer-col">
        <h2 class="footer-heading">Chew&#39;s Everyday Blog</h2>By wisdom a house is built, and through understanding it is established.</div>
      <div class="footer-col">
        <ul class="contact-list">
          <li class="p-name">Author: Chew Y. Feng</li><li>
              <span>
                Mail: 
              </span>
            <a class="u-email" href="mailto:chew.y.feng@outlook.com">chew.y.feng@outlook.com</a></li><div>
              Find me:<ul class="social-media-list"><li><a href="https://github.com/excitedspider"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">excitedspider</span></a></li><li><a href="https://www.linkedin.com/in/qiuyi-feng-348968287"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#linkedin"></use></svg> <span class="username">qiuyi-feng-348968287</span></a></li></ul>
</div>
            <div class="footer-col-rss">
              <p class="rss-subscribe">subscribe <a href="/feed.xml">via RSS</a></p>
            </div>
        </ul>
      </div>

    </div>

  </div>

</footer>
</body>

</html>
