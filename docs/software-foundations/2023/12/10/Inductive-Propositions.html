<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Inductive Propositions | Chew’s Everyday Blog</title>
<meta name="generator" content="Jekyll v3.9.3" />
<meta property="og:title" content="Inductive Propositions" />
<meta name="author" content="Chew Y. Feng" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Apart from normal “declarative” style, propositions can also be defined inductively." />
<meta property="og:description" content="Apart from normal “declarative” style, propositions can also be defined inductively." />
<link rel="canonical" href="/software-foundations/2023/12/10/Inductive-Propositions.html" />
<meta property="og:url" content="/software-foundations/2023/12/10/Inductive-Propositions.html" />
<meta property="og:site_name" content="Chew’s Everyday Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-12-10T00:00:00+11:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Inductive Propositions" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Chew Y. Feng"},"dateModified":"2023-12-22T14:40:08+11:00","datePublished":"2023-12-10T00:00:00+11:00","description":"Apart from normal “declarative” style, propositions can also be defined inductively.","headline":"Inductive Propositions","mainEntityOfPage":{"@type":"WebPage","@id":"/software-foundations/2023/12/10/Inductive-Propositions.html"},"url":"/software-foundations/2023/12/10/Inductive-Propositions.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="Chew&apos;s Everyday Blog" /><script>
    // for MathJax inline
    window.MathJax = {
      tex: {
        inlineMath: [['_', '_'], ['$', '$'], ['\\(', '\\)']]
      }
    };
  </script>
  <script type="text/javascript" id="MathJax-script" async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/css-doodle/0.37.4/css-doodle.min.js"></script>
  <link rel="stylesheet"
          href="https://fonts.googleapis.com/css?family=Teko">
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-4TZZDRT6JY"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-4TZZDRT6JY');
  </script>
</head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Chew&#39;s Everyday Blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a><a class="page-link" href="/categories/">Categories</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="page-content-background">
        <css-doodle click-to-update>
          <style>
            @grid: 1 / 100vw 100vh / #0a0c27;
            background-size: 200px 200px;
            background-image: @doodle(
              @grid: 6 / 100%;
              @size: 4px;
              font-size: 4px;
              color: hsl(@r240, 30%, 50%);
              box-shadow: @m3x5(
                calc(4em - @nx * 1em) calc(@ny * 1em)
                  @p(@m3(currentColor), @m2(transparent)),
                calc(2em + @nx * 1em) calc(@ny * 1em)
                  @lp
              );
            );
          </style>
        </css-doodle>
      </div>
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Inductive Propositions</h1>
    <p class="post-meta"><span class="tags">
        
          <span>Coq</span>
        
      </span><time class="dt-published" datetime="2023-12-10T00:00:00+11:00" itemprop="datePublished">
        Posted At: Dec 10, 2023
      </time><time>
        Modified At: Dec 22, 2023
      </time><span class="dt-tags">
        Category:
        
          <span>Software-Foundations</span>
        
      </span></p>
  </header>


  <div class="post-content e-content" itemprop="articleBody">
    <ul id="markdown-toc">
  <li><a href="#inductive-propositions" id="markdown-toc-inductive-propositions">Inductive Propositions</a>    <ul>
      <li><a href="#example-permutations" id="markdown-toc-example-permutations">Example: Permutations</a></li>
    </ul>
  </li>
  <li><a href="#inductive-properties" id="markdown-toc-inductive-properties">Inductive Properties</a>    <ul>
      <li><a href="#inversion-on-evidence" id="markdown-toc-inversion-on-evidence">Inversion on Evidence</a></li>
      <li><a href="#induction-on-evidence" id="markdown-toc-induction-on-evidence">Induction on Evidence</a></li>
    </ul>
  </li>
  <li><a href="#inductive-relations" id="markdown-toc-inductive-relations">Inductive Relations</a></li>
  <li><a href="#case-study---regular-expressions" id="markdown-toc-case-study---regular-expressions">Case Study - Regular Expressions</a></li>
  <li><a href="#case-study-reflection" id="markdown-toc-case-study-reflection">Case Study: Reflection</a></li>
  <li><a href="#reference" id="markdown-toc-reference">Reference</a></li>
</ul>

<h2 id="inductive-propositions">Inductive Propositions</h2>
<p>Apart from normal “declarative” style, propositions can also be defined <em>inductively</em>. <em>Inductively defined propositions</em> is analogue to recursive functions, but more powerful as Coq has strict restrictions on functions that make them always decidable<sup id="fnref:2" role="doc-noteref"><a href="#fn:2" class="footnote" rel="footnote">1</a></sup>. To be more specific, functions in Coq are required to be total. On the other hand, there is no rule applied to inductive propositions, which is a fine line between decidable and undecidable.</p>

<p>The example given in the software foundation<sup id="fnref:1" role="doc-noteref"><a href="#fn:1" class="footnote" rel="footnote">2</a></sup> that illustrates this analogue is the <em>Collatz Conjecture</em>, which states that repeating two simple arithmetic operations will eventually transform every positive integer into 1<sup id="fnref:3" role="doc-noteref"><a href="#fn:3" class="footnote" rel="footnote">3</a></sup>. 
This example is so brilliant that I can’t devise a better one to replace it.</p>

<p>To be more specific, these two operations are</p>
<ul>
  <li>If the number is even, divide it by two.</li>
  <li>If the number is odd, triple it and add one.</li>
</ul>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Fixpoint</span><span class="w"> </span><span class="no">div2</span><span class="w"> </span><span class="o">(</span><span class="no">n</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">nat</span><span class="o">)</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w">
  </span><span class="kr">match</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="kp">with</span><span class="w">
    </span><span class="mi">0</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w">
  </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w">
  </span><span class="o">|</span><span class="w"> </span><span class="no">S</span><span class="w"> </span><span class="o">(</span><span class="no">S</span><span class="w"> </span><span class="no">n</span><span class="o">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="no">S</span><span class="w"> </span><span class="o">(</span><span class="no">div2</span><span class="w"> </span><span class="no">n</span><span class="o">)</span><span class="w">
  </span><span class="kr">end</span><span class="pi">.</span><span class="w">

</span><span class="k">Definition</span><span class="w"> </span><span class="no">f</span><span class="w"> </span><span class="o">(</span><span class="no">n</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">nat</span><span class="o">)</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w">
  </span><span class="kr">if</span><span class="w"> </span><span class="no">even</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="no">div2</span><span class="w"> </span><span class="no">n</span><span class="w">
  </span><span class="kr">else</span><span class="w"> </span><span class="o">(</span><span class="mi">3</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="no">n</span><span class="o">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="o">.</span><span class="w">
</span></code></pre></div></div>

<p>To examine this conjecture, we can try to define a function that perform the calculation, but only find coq rejects it:</p>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Fail</span><span class="w"> </span><span class="k">Fixpoint</span><span class="w"> </span><span class="no">reaches_1_in</span><span class="w"> </span><span class="o">(</span><span class="no">n</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">nat</span><span class="o">)</span><span class="p">:</span><span class="w"> </span><span class="no">nat</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w">
  </span><span class="kr">if</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="o">=?</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="mi">0</span><span class="w">
  </span><span class="kr">else</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="no">reaches_1_in</span><span class="w"> </span><span class="o">(</span><span class="no">f</span><span class="w"> </span><span class="no">n</span><span class="o">).</span><span class="w">
</span></code></pre></div></div>

<p>Coq rejects it because there is no guarantee that this calculation would eventually halt, thus it’s not a decidable problem  (It is proved to be undecidable formally<sup id="fnref:3:1" role="doc-noteref"><a href="#fn:3" class="footnote" rel="footnote">3</a></sup>). But we can express the concept as an <em>inductively defined property</em> of numbers:</p>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Inductive</span><span class="w"> </span><span class="no">Collatz_holds_for</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">nat</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kr">Prop</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w">
  </span><span class="o">|</span><span class="w"> </span><span class="no">Chf_done</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">Collatz_holds_for</span><span class="w"> </span><span class="mi">1</span><span class="w">
  </span><span class="o">|</span><span class="w"> </span><span class="no">Chf_more</span><span class="w"> </span><span class="o">(</span><span class="no">n</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">nat</span><span class="o">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">Collatz_holds_for</span><span class="w"> </span><span class="o">(</span><span class="no">f</span><span class="w"> </span><span class="no">n</span><span class="o">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">Collatz_holds_for</span><span class="w"> </span><span class="no">n</span><span class="pi">.</span><span class="w">
</span></code></pre></div></div>

<p>The inductive proposition <code class="language-plaintext highlighter-rouge">Collatz_holds_for</code> is informally read as: 
“On input n, the property holds true when $n=1$, or when $f(n)$ holds.”</p>

<blockquote class="note">
  <p>Conventionally, a proposition with one parameter is called a <em>property</em>, and a proposition with two or more parameters is called a <em>relation</em>.</p>
</blockquote>

<p>Unlike functions, propositions cannot always be calculated automatically. For a particular number, we should guild the “calculation” for Coq.</p>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Example</span><span class="w"> </span><span class="no">Collatz_holds_for_12</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">Collatz_holds_for</span><span class="w"> </span><span class="mi">12</span><span class="o">.</span><span class="w">
</span><span class="k">Proof</span><span class="pi">.</span><span class="w">
  </span><span class="kp">apply</span><span class="w"> </span><span class="no">Chf_more</span><span class="pi">.</span><span class="w"> </span><span class="kp">unfold</span><span class="w"> </span><span class="no">f</span><span class="pi">.</span><span class="w"> </span><span class="kp">simpl</span><span class="pi">.</span><span class="w">
  </span><span class="kp">apply</span><span class="w"> </span><span class="no">Chf_more</span><span class="pi">.</span><span class="w"> </span><span class="kp">unfold</span><span class="w"> </span><span class="no">f</span><span class="pi">.</span><span class="w"> </span><span class="kp">simpl</span><span class="pi">.</span><span class="w">
  </span><span class="kp">apply</span><span class="w"> </span><span class="no">Chf_more</span><span class="pi">.</span><span class="w"> </span><span class="kp">unfold</span><span class="w"> </span><span class="no">f</span><span class="pi">.</span><span class="w"> </span><span class="kp">simpl</span><span class="pi">.</span><span class="w">
  </span><span class="kp">apply</span><span class="w"> </span><span class="no">Chf_more</span><span class="pi">.</span><span class="w"> </span><span class="kp">unfold</span><span class="w"> </span><span class="no">f</span><span class="pi">.</span><span class="w"> </span><span class="kp">simpl</span><span class="pi">.</span><span class="w">
  </span><span class="kp">apply</span><span class="w"> </span><span class="no">Chf_more</span><span class="pi">.</span><span class="w"> </span><span class="kp">unfold</span><span class="w"> </span><span class="no">f</span><span class="pi">.</span><span class="w"> </span><span class="kp">simpl</span><span class="pi">.</span><span class="w">
  </span><span class="kp">apply</span><span class="w"> </span><span class="no">Chf_more</span><span class="pi">.</span><span class="w"> </span><span class="kp">unfold</span><span class="w"> </span><span class="no">f</span><span class="pi">.</span><span class="w"> </span><span class="kp">simpl</span><span class="pi">.</span><span class="w">
  </span><span class="kp">apply</span><span class="w"> </span><span class="no">Chf_more</span><span class="pi">.</span><span class="w"> </span><span class="kp">unfold</span><span class="w"> </span><span class="no">f</span><span class="pi">.</span><span class="w"> </span><span class="kp">simpl</span><span class="pi">.</span><span class="w">
  </span><span class="kp">apply</span><span class="w"> </span><span class="no">Chf_more</span><span class="pi">.</span><span class="w"> </span><span class="kp">unfold</span><span class="w"> </span><span class="no">f</span><span class="pi">.</span><span class="w"> </span><span class="kp">simpl</span><span class="pi">.</span><span class="w">
  </span><span class="kp">apply</span><span class="w"> </span><span class="no">Chf_more</span><span class="pi">.</span><span class="w"> </span><span class="kp">unfold</span><span class="w"> </span><span class="no">f</span><span class="pi">.</span><span class="w"> </span><span class="kp">simpl</span><span class="pi">.</span><span class="w">
  </span><span class="kp">apply</span><span class="w"> </span><span class="no">Chf_done</span><span class="pi">.</span><span class="w">  </span><span class="k">Qed</span><span class="pi">.</span><span class="w">
</span></code></pre></div></div>

<p>Finally, the proposition <code class="language-plaintext highlighter-rouge">Collatz_holds_for</code> can be viewed as a subset of <code class="language-plaintext highlighter-rouge">nat</code>, which contains all provable elements. The Collatz Conjectures ask whether the size of the subset is actually as large as <code class="language-plaintext highlighter-rouge">nat</code> itself.</p>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Conjecture</span><span class="w"> </span><span class="no">collatz</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">forall</span><span class="w"> </span><span class="no">n</span><span class="o">,</span><span class="w"> </span><span class="no">Collatz_holds_for</span><span class="w"> </span><span class="no">n</span><span class="pi">.</span><span class="w">
</span></code></pre></div></div>

<p>So far (2023), mathematicians haven’t find a way to prove or disprove this Conjecture<sup id="fnref:3:2" role="doc-noteref"><a href="#fn:3" class="footnote" rel="footnote">3</a></sup>.</p>
<h3 id="example-permutations">Example: Permutations</h3>
<p>A permutation of a ordered set is a rearrangement into a new order by some rules. For example, the proposition <code class="language-plaintext highlighter-rouge">Perm3</code> defines a set of permutation rules on 3-elements set.</p>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Inductive</span><span class="w"> </span><span class="no">Perm3</span><span class="w"> </span><span class="o">{</span><span class="no">X</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">Type</span><span class="o">}</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">list</span><span class="w"> </span><span class="no">X</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">list</span><span class="w"> </span><span class="no">X</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kr">Prop</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w">
  </span><span class="o">|</span><span class="w"> </span><span class="no">perm3_swap12</span><span class="w"> </span><span class="o">(</span><span class="no">a</span><span class="w"> </span><span class="no">b</span><span class="w"> </span><span class="no">c</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">X</span><span class="o">)</span><span class="w"> </span><span class="p">:</span><span class="w">
      </span><span class="no">Perm3</span><span class="w"> </span><span class="o">[</span><span class="no">a</span><span class="p">;</span><span class="no">b</span><span class="p">;</span><span class="no">c</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="no">b</span><span class="p">;</span><span class="no">a</span><span class="p">;</span><span class="no">c</span><span class="o">]</span><span class="w">
  </span><span class="o">|</span><span class="w"> </span><span class="no">perm3_swap23</span><span class="w"> </span><span class="o">(</span><span class="no">a</span><span class="w"> </span><span class="no">b</span><span class="w"> </span><span class="no">c</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">X</span><span class="o">)</span><span class="w"> </span><span class="p">:</span><span class="w">
      </span><span class="no">Perm3</span><span class="w"> </span><span class="o">[</span><span class="no">a</span><span class="p">;</span><span class="no">b</span><span class="p">;</span><span class="no">c</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="no">a</span><span class="p">;</span><span class="no">c</span><span class="p">;</span><span class="no">b</span><span class="o">]</span><span class="w">
  </span><span class="o">|</span><span class="w"> </span><span class="no">perm3_trans</span><span class="w"> </span><span class="o">(</span><span class="no">l1</span><span class="w"> </span><span class="no">l2</span><span class="w"> </span><span class="no">l3</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">list</span><span class="w"> </span><span class="no">X</span><span class="o">)</span><span class="w"> </span><span class="p">:</span><span class="w">
      </span><span class="no">Perm3</span><span class="w"> </span><span class="no">l1</span><span class="w"> </span><span class="no">l2</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">Perm3</span><span class="w"> </span><span class="no">l2</span><span class="w"> </span><span class="no">l3</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">Perm3</span><span class="w"> </span><span class="no">l1</span><span class="w"> </span><span class="no">l3</span><span class="pi">.</span><span class="w">
</span></code></pre></div></div>

<p>Informally, we call an ordered set to be a permutation of another set if we can achieve it by:</p>
<ul>
  <li>swap the first and the second element; or</li>
  <li>swap the second and the third element; or</li>
  <li>combine any number of permutation operations</li>
</ul>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">(* Exercise: 1 star, standard, optional (perm) *)</span><span class="w">

</span><span class="k">Example</span><span class="w"> </span><span class="no">exercise_perm_1</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">Perm3</span><span class="w"> </span><span class="o">[</span><span class="mi">1</span><span class="p">;</span><span class="mi">2</span><span class="p">;</span><span class="mi">3</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="mi">3</span><span class="p">;</span><span class="mi">2</span><span class="p">;</span><span class="mi">1</span><span class="o">].</span><span class="w">
</span><span class="k">Proof</span><span class="pi">.</span><span class="w">
  </span><span class="kp">apply</span><span class="w"> </span><span class="no">perm3_trans</span><span class="w"> </span><span class="kp">with</span><span class="w"> </span><span class="o">[</span><span class="mi">3</span><span class="p">;</span><span class="mi">1</span><span class="p">;</span><span class="mi">2</span><span class="o">].</span><span class="w">
  </span><span class="o">-</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">perm3_trans</span><span class="w"> </span><span class="kp">with</span><span class="w"> </span><span class="o">[</span><span class="mi">1</span><span class="p">;</span><span class="mi">3</span><span class="p">;</span><span class="mi">2</span><span class="o">].</span><span class="w">
    </span><span class="o">+</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">perm3_swap23</span><span class="pi">.</span><span class="w">
    </span><span class="o">+</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">perm3_swap12</span><span class="pi">.</span><span class="w">  
  </span><span class="o">-</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">perm3_swap23</span><span class="pi">.</span><span class="w">
</span><span class="k">Qed</span><span class="pi">.</span><span class="w">

</span><span class="k">Example</span><span class="w"> </span><span class="no">exercise_perm_2</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">Perm3</span><span class="w"> </span><span class="o">[</span><span class="mi">1</span><span class="p">;</span><span class="mi">2</span><span class="p">;</span><span class="mi">3</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="mi">1</span><span class="p">;</span><span class="mi">2</span><span class="p">;</span><span class="mi">3</span><span class="o">].</span><span class="w">
</span><span class="k">Proof</span><span class="pi">.</span><span class="w">
  </span><span class="kp">apply</span><span class="w"> </span><span class="no">perm3_trans</span><span class="w"> </span><span class="kp">with</span><span class="w"> </span><span class="o">[</span><span class="mi">1</span><span class="p">;</span><span class="mi">3</span><span class="p">;</span><span class="mi">2</span><span class="o">].</span><span class="w">
  </span><span class="o">-</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">perm3_swap23</span><span class="pi">.</span><span class="w">
  </span><span class="o">-</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">perm3_swap23</span><span class="pi">.</span><span class="w">
</span><span class="k">Qed</span><span class="pi">.</span><span class="w"> 
</span></code></pre></div></div>

<h2 id="inductive-properties">Inductive Properties</h2>
<p>The property “the set of even numbers” can also be expressed in a inductive style:</p>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Inductive</span><span class="w"> </span><span class="no">ev</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">nat</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kr">Prop</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w">
  </span><span class="o">|</span><span class="w"> </span><span class="no">ev_0</span><span class="w">                       </span><span class="p">:</span><span class="w"> </span><span class="no">ev</span><span class="w"> </span><span class="mi">0</span><span class="w">
  </span><span class="o">|</span><span class="w"> </span><span class="no">ev_SS</span><span class="w"> </span><span class="o">(</span><span class="no">n</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">nat</span><span class="o">)</span><span class="w"> </span><span class="o">(</span><span class="no">H</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">ev</span><span class="w"> </span><span class="no">n</span><span class="o">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">ev</span><span class="w"> </span><span class="o">(</span><span class="no">S</span><span class="w"> </span><span class="o">(</span><span class="no">S</span><span class="w"> </span><span class="no">n</span><span class="o">)).</span><span class="w">
</span></code></pre></div></div>

<blockquote class="note">
  <p>Note that the hypothesis H is written to the left side of colon instead of on the left of implication symbol $H \to P$. It is nothing but a notation.</p>
</blockquote>

<p>The definition of <code class="language-plaintext highlighter-rouge">ev</code> can be thought as “primitive <strong><em>evidences</em></strong> of evenness”, which is again, an analogue to “constructors” of  inductive types. In other words, if we know beforehand a number $n$ is an even number, it must be one of two things:</p>
<ul>
  <li>$n$ is <code class="language-plaintext highlighter-rouge">ev_0</code>, that is, $n = 0$</li>
  <li>$n$ is <code class="language-plaintext highlighter-rouge">ev_SS</code>, that is, $n-2$ is an even number.
Thus, we can reasoning about how the n is built. It is possible to use it by <em>case analysis</em>, or <em>by induction</em>.</li>
</ul>

<h3 id="inversion-on-evidence">Inversion on Evidence</h3>
<p>When the tactic <code class="language-plaintext highlighter-rouge">inversion</code> is applied on evidence, it looks at each of the constructor of an evidence, performs case analysis and generates subgoals. It tries to throws apparent self-contradictory subgoals as well.</p>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">(* Exercise: 1 star, standard (inversion_practice) *)</span><span class="w">

</span><span class="k">Theorem</span><span class="w"> </span><span class="no">SSSSev__even</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">forall</span><span class="w"> </span><span class="no">n</span><span class="o">,</span><span class="w">
  </span><span class="no">ev</span><span class="w"> </span><span class="o">(</span><span class="no">S</span><span class="w"> </span><span class="o">(</span><span class="no">S</span><span class="w"> </span><span class="o">(</span><span class="no">S</span><span class="w"> </span><span class="o">(</span><span class="no">S</span><span class="w"> </span><span class="no">n</span><span class="o">))))</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">ev</span><span class="w"> </span><span class="no">n</span><span class="pi">.</span><span class="w">
</span><span class="k">Proof</span><span class="pi">.</span><span class="w">
  </span><span class="kp">intros</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="no">H</span><span class="pi">.</span><span class="w">
  </span><span class="kp">inversion</span><span class="w"> </span><span class="no">H</span><span class="pi">.</span><span class="w">
  </span><span class="kp">inversion</span><span class="w"> </span><span class="no">H1</span><span class="pi">.</span><span class="w">
  </span><span class="kp">apply</span><span class="w"> </span><span class="no">H3</span><span class="pi">.</span><span class="w">
</span><span class="k">Qed</span><span class="pi">.</span><span class="w">
</span></code></pre></div></div>

<h3 id="induction-on-evidence">Induction on Evidence</h3>
<p>The tactic <code class="language-plaintext highlighter-rouge">induction</code> is also applicable on evidence. It causes Coq to generates “basic” subgoals for “basic” constructors and induction subgoals for recursive occurrence of the property, together with an induction hypothesis with each.</p>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">(** Exercise: 2 stars, standard (ev_sum) *)</span><span class="w">
</span><span class="k">Theorem</span><span class="w"> </span><span class="no">ev_sum</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">forall</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="no">m</span><span class="o">,</span><span class="w"> </span><span class="no">ev</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">ev</span><span class="w"> </span><span class="no">m</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">ev</span><span class="w"> </span><span class="o">(</span><span class="no">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="no">m</span><span class="o">).</span><span class="w">
</span><span class="k">Proof</span><span class="pi">.</span><span class="w">
  </span><span class="kp">intros</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="no">m</span><span class="w"> </span><span class="no">EV</span><span class="w"> </span><span class="no">EM</span><span class="pi">.</span><span class="w">
  </span><span class="kp">induction</span><span class="w"> </span><span class="no">EV</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="o">[|</span><span class="w"> </span><span class="no">x</span><span class="w"> </span><span class="no">y</span><span class="w"> </span><span class="no">IHEV</span><span class="o">].</span><span class="w">
  </span><span class="o">-</span><span class="w"> </span><span class="c">(* ev_0: n = 0 *)</span><span class="w"> </span><span class="kp">simpl</span><span class="pi">.</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">EM</span><span class="pi">.</span><span class="w">
  </span><span class="o">-</span><span class="w"> </span><span class="c">(* ev_SS: ev (n - 2) -&gt; ev n *)</span><span class="w"> </span><span class="kp">simpl</span><span class="pi">.</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">ev_SS</span><span class="pi">.</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">IHEV</span><span class="pi">.</span><span class="w">
</span><span class="k">Qed</span><span class="pi">.</span><span class="w">

</span><span class="c">(** Exercise: 3 stars, advanced, especially useful (ev_ev__ev) *)</span><span class="w">
</span><span class="k">Theorem</span><span class="w"> </span><span class="no">ev_ev__ev</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">forall</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="no">m</span><span class="o">,</span><span class="w">
  </span><span class="no">ev</span><span class="w"> </span><span class="o">(</span><span class="no">n</span><span class="o">+</span><span class="no">m</span><span class="o">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">ev</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">ev</span><span class="w"> </span><span class="no">m</span><span class="pi">.</span><span class="w">
</span><span class="k">Proof</span><span class="pi">.</span><span class="w">
  </span><span class="kp">intros</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="no">m</span><span class="w"> </span><span class="no">ENM</span><span class="w"> </span><span class="no">EN</span><span class="pi">.</span><span class="w">
  </span><span class="kp">induction</span><span class="w"> </span><span class="no">EN</span><span class="pi">.</span><span class="w">
  </span><span class="o">-</span><span class="w"> </span><span class="kp">simpl</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="no">ENM</span><span class="pi">.</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">ENM</span><span class="pi">.</span><span class="w">
  </span><span class="o">-</span><span class="w"> </span><span class="kp">simpl</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="no">ENM</span><span class="pi">.</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">ev_SS</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="no">ENM</span><span class="pi">.</span><span class="w">
    </span><span class="no">assert</span><span class="o">(</span><span class="no">H</span><span class="p">:</span><span class="w"> </span><span class="kr">forall</span><span class="w"> </span><span class="no">n</span><span class="o">,</span><span class="w"> </span><span class="no">ev</span><span class="w"> </span><span class="o">(</span><span class="no">S</span><span class="w"> </span><span class="o">(</span><span class="no">S</span><span class="w"> </span><span class="no">n</span><span class="o">))</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">ev</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="o">).</span><span class="w">
    </span><span class="o">{</span><span class="w">
      </span><span class="kp">intros</span><span class="w"> </span><span class="no">n0</span><span class="w"> </span><span class="no">H</span><span class="pi">.</span><span class="w"> 
      </span><span class="kp">apply</span><span class="w"> </span><span class="no">ev_inversion</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="no">H</span><span class="pi">.</span><span class="w"> </span><span class="kp">destruct</span><span class="w"> </span><span class="no">H</span><span class="pi">.</span><span class="w">
      </span><span class="o">-</span><span class="w"> </span><span class="no">discriminate</span><span class="w"> </span><span class="no">H</span><span class="pi">.</span><span class="w">
      </span><span class="o">-</span><span class="w"> </span><span class="kp">destruct</span><span class="w"> </span><span class="no">H</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="o">[</span><span class="no">n'</span><span class="w"> </span><span class="o">[</span><span class="no">H1</span><span class="w"> </span><span class="no">H2</span><span class="o">]].</span><span class="w"> </span><span class="kp">injection</span><span class="w"> </span><span class="no">H1</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="no">H1I</span><span class="pi">.</span><span class="w">
        </span><span class="kp">rewrite</span><span class="w"> </span><span class="no">H1I</span><span class="pi">.</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">H2</span><span class="pi">.</span><span class="w"> 
    </span><span class="o">}</span><span class="w">
    </span><span class="kp">apply</span><span class="w"> </span><span class="no">H</span><span class="o">,</span><span class="w"> </span><span class="no">H</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="no">ENM</span><span class="pi">.</span><span class="w">
    </span><span class="kp">apply</span><span class="w"> </span><span class="no">IHEN</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="no">ENM</span><span class="pi">.</span><span class="w">
    </span><span class="kp">apply</span><span class="w"> </span><span class="no">ENM</span><span class="pi">.</span><span class="w">
</span><span class="k">Qed</span><span class="pi">.</span><span class="w">
</span></code></pre></div></div>
<h2 id="inductive-relations">Inductive Relations</h2>
<p>A naive example is a <em>total</em> relation, which holds for every pair of inputs:</p>
<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">(* Exercise: 2 stars, standard, optional (total_relation) *)</span><span class="w">
</span><span class="k">Inductive</span><span class="w"> </span><span class="no">total_relation</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">nat</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">nat</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kr">Prop</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w">
  </span><span class="o">|</span><span class="w"> </span><span class="no">total_n</span><span class="w"> </span><span class="o">(</span><span class="no">n</span><span class="w"> </span><span class="no">m</span><span class="p">:</span><span class="w"> </span><span class="no">nat</span><span class="o">)</span><span class="p">:</span><span class="w"> </span><span class="no">total_relation</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="no">m</span><span class="pi">.</span><span class="w">

</span><span class="k">Theorem</span><span class="w"> </span><span class="no">total_relation_is_total</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">forall</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="no">m</span><span class="o">,</span><span class="w"> </span><span class="no">total_relation</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="no">m</span><span class="pi">.</span><span class="w">
  </span><span class="k">Proof</span><span class="pi">.</span><span class="w"> </span><span class="kp">intros</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="no">m</span><span class="pi">.</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">total_n</span><span class="pi">.</span><span class="w">
</span><span class="k">Qed</span><span class="pi">.</span><span class="w">
</span></code></pre></div></div>

<p>As a more nontrivial case, the “less than or equal” relation is a good entrance to study how to reason about inductive relations.</p>
<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Inductive</span><span class="w"> </span><span class="no">le</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">nat</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">nat</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kr">Prop</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w">
  </span><span class="o">|</span><span class="w"> </span><span class="no">le_n</span><span class="w"> </span><span class="o">(</span><span class="no">n</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">nat</span><span class="o">)</span><span class="w">                </span><span class="p">:</span><span class="w"> </span><span class="no">le</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="no">n</span><span class="w">
  </span><span class="o">|</span><span class="w"> </span><span class="no">le_S</span><span class="w"> </span><span class="o">(</span><span class="no">n</span><span class="w"> </span><span class="no">m</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">nat</span><span class="o">)</span><span class="w"> </span><span class="o">(</span><span class="no">H</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">le</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="no">m</span><span class="o">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">le</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="o">(</span><span class="no">S</span><span class="w"> </span><span class="no">m</span><span class="o">).</span><span class="w">

</span><span class="k">Notation</span><span class="w"> </span><span class="s2">"n &lt;= m"</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="o">(</span><span class="no">le</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="no">m</span><span class="o">).</span><span class="w">

</span><span class="k">Definition</span><span class="w"> </span><span class="no">lt</span><span class="w"> </span><span class="o">(</span><span class="no">n</span><span class="w"> </span><span class="no">m</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">nat</span><span class="o">)</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="no">le</span><span class="w"> </span><span class="o">(</span><span class="no">S</span><span class="w"> </span><span class="no">n</span><span class="o">)</span><span class="w"> </span><span class="no">m</span><span class="pi">.</span><span class="w">

</span><span class="k">Notation</span><span class="w"> </span><span class="s2">"n &lt; m"</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="o">(</span><span class="no">lt</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="no">m</span><span class="o">).</span><span class="w">
</span></code></pre></div></div>

<p>There are many facts we can play with <code class="language-plaintext highlighter-rouge">le</code>. For example, we are going to show that for any two number $n,m$, it’s always $n&lt;m$ or $n &gt;= m$.</p>
<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">(** Exercise: le_and_lt_facts *)</span><span class="w">

</span><span class="k">Lemma</span><span class="w"> </span><span class="no">n_le_m__Sn_le_Sm</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">forall</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="no">m</span><span class="o">,</span><span class="w">
  </span><span class="no">n</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="no">m</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">S</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="no">S</span><span class="w"> </span><span class="no">m</span><span class="pi">.</span><span class="w">
</span><span class="k">Proof</span><span class="pi">.</span><span class="w">
  </span><span class="kp">intros</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="no">m</span><span class="w"> </span><span class="no">Hnm</span><span class="pi">.</span><span class="w">
  </span><span class="kp">induction</span><span class="w"> </span><span class="no">Hnm</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="o">[|</span><span class="w"> </span><span class="no">n'</span><span class="w"> </span><span class="no">IH</span><span class="w"> </span><span class="no">IE</span><span class="o">].</span><span class="w">
  </span><span class="o">-</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">le_n</span><span class="pi">.</span><span class="w">
  </span><span class="o">-</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">le_S</span><span class="pi">.</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">IE</span><span class="pi">.</span><span class="w">
</span><span class="k">Qed</span><span class="pi">.</span><span class="w">   

</span><span class="k">Theorem</span><span class="w"> </span><span class="no">lt_ge_cases</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">forall</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="no">m</span><span class="o">,</span><span class="w">
  </span><span class="no">n</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="no">m</span><span class="w"> </span><span class="o">\/</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="no">m</span><span class="pi">.</span><span class="w">
</span><span class="k">Proof</span><span class="pi">.</span><span class="w">
  </span><span class="kp">intros</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="no">m</span><span class="pi">.</span><span class="w">
  </span><span class="kp">induction</span><span class="w"> </span><span class="no">n</span><span class="pi">.</span><span class="w">
  </span><span class="kp">destruct</span><span class="w"> </span><span class="no">m</span><span class="pi">.</span><span class="w"> 
  </span><span class="o">{</span><span class="w"> </span><span class="no">right</span><span class="pi">.</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">le_n</span><span class="pi">.</span><span class="w"> </span><span class="o">}</span><span class="w">
  </span><span class="o">{</span><span class="w">
    </span><span class="no">left</span><span class="pi">.</span><span class="w"> </span><span class="kp">unfold</span><span class="w"> </span><span class="no">lt</span><span class="pi">.</span><span class="w"> </span><span class="kp">induction</span><span class="w"> </span><span class="no">m</span><span class="pi">.</span><span class="w">
    </span><span class="o">-</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">le_n</span><span class="pi">.</span><span class="w">
    </span><span class="o">-</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">le_S</span><span class="pi">.</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">IHm</span><span class="pi">.</span><span class="w">      
  </span><span class="o">}</span><span class="w">
  </span><span class="o">{</span><span class="w">
    </span><span class="kp">destruct</span><span class="w"> </span><span class="no">IHn</span><span class="pi">.</span><span class="w">
    </span><span class="o">-</span><span class="w"> </span><span class="kp">unfold</span><span class="w"> </span><span class="no">lt</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="no">H</span><span class="pi">.</span><span class="w"> </span><span class="kp">unfold</span><span class="w"> </span><span class="no">lt</span><span class="pi">.</span><span class="w"> </span><span class="kp">inversion</span><span class="w"> </span><span class="no">H</span><span class="pi">.</span><span class="w">
      </span><span class="o">+</span><span class="w"> </span><span class="no">right</span><span class="pi">.</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">le_n</span><span class="pi">.</span><span class="w">
      </span><span class="o">+</span><span class="w"> </span><span class="no">left</span><span class="pi">.</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">n_le_m__Sn_le_Sm</span><span class="pi">.</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">H0</span><span class="pi">.</span><span class="w">
    </span><span class="o">-</span><span class="w"> </span><span class="no">right</span><span class="pi">.</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">le_S</span><span class="pi">.</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">H</span><span class="pi">.</span><span class="w">
  </span><span class="o">}</span><span class="w">
</span><span class="k">Qed</span><span class="pi">.</span><span class="w"> 
</span></code></pre></div></div>

<p>We can also define 3-place relations as well, just the same way as binary relations.</p>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">(** Exercise: 3 stars, standard, especially useful (R_provability) *)</span><span class="w">

</span><span class="k">Inductive</span><span class="w"> </span><span class="no">R</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">nat</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">nat</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">nat</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kr">Prop</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w">
  </span><span class="o">|</span><span class="w"> </span><span class="no">c1</span><span class="w">                                     </span><span class="p">:</span><span class="w"> </span><span class="no">R</span><span class="w"> </span><span class="mi">0</span><span class="w">     </span><span class="mi">0</span><span class="w">     </span><span class="mi">0</span><span class="w">
  </span><span class="o">|</span><span class="w"> </span><span class="no">c2</span><span class="w"> </span><span class="no">m</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="no">o</span><span class="w"> </span><span class="o">(</span><span class="no">H</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">R</span><span class="w"> </span><span class="no">m</span><span class="w">     </span><span class="no">n</span><span class="w">     </span><span class="no">o</span><span class="w">        </span><span class="o">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">R</span><span class="w"> </span><span class="o">(</span><span class="no">S</span><span class="w"> </span><span class="no">m</span><span class="o">)</span><span class="w"> </span><span class="no">n</span><span class="w">     </span><span class="o">(</span><span class="no">S</span><span class="w"> </span><span class="no">o</span><span class="o">)</span><span class="w">
  </span><span class="o">|</span><span class="w"> </span><span class="no">c3</span><span class="w"> </span><span class="no">m</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="no">o</span><span class="w"> </span><span class="o">(</span><span class="no">H</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">R</span><span class="w"> </span><span class="no">m</span><span class="w">     </span><span class="no">n</span><span class="w">     </span><span class="no">o</span><span class="w">        </span><span class="o">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">R</span><span class="w"> </span><span class="no">m</span><span class="w">     </span><span class="o">(</span><span class="no">S</span><span class="w"> </span><span class="no">n</span><span class="o">)</span><span class="w"> </span><span class="o">(</span><span class="no">S</span><span class="w"> </span><span class="no">o</span><span class="o">)</span><span class="w">
  </span><span class="o">|</span><span class="w"> </span><span class="no">c4</span><span class="w"> </span><span class="no">m</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="no">o</span><span class="w"> </span><span class="o">(</span><span class="no">H</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">R</span><span class="w"> </span><span class="o">(</span><span class="no">S</span><span class="w"> </span><span class="no">m</span><span class="o">)</span><span class="w"> </span><span class="o">(</span><span class="no">S</span><span class="w"> </span><span class="no">n</span><span class="o">)</span><span class="w"> </span><span class="o">(</span><span class="no">S</span><span class="w"> </span><span class="o">(</span><span class="no">S</span><span class="w"> </span><span class="no">o</span><span class="o">)))</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">R</span><span class="w"> </span><span class="no">m</span><span class="w">     </span><span class="no">n</span><span class="w">     </span><span class="no">o</span><span class="w">
  </span><span class="o">|</span><span class="w"> </span><span class="no">c5</span><span class="w"> </span><span class="no">m</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="no">o</span><span class="w"> </span><span class="o">(</span><span class="no">H</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">R</span><span class="w"> </span><span class="no">m</span><span class="w">     </span><span class="no">n</span><span class="w">     </span><span class="no">o</span><span class="w">        </span><span class="o">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">R</span><span class="w"> </span><span class="no">n</span><span class="w">     </span><span class="no">m</span><span class="w">     </span><span class="no">o</span><span class="w">
</span><span class="o">.</span><span class="w">

</span><span class="c">(** If we dropped constructor [c5] from the definition of [R],
	would the set of provable propositions change? *)</span><span class="w">
</span><span class="k">Inductive</span><span class="w"> </span><span class="no">R'</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">nat</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">nat</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">nat</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kr">Prop</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w">
  </span><span class="o">|</span><span class="w"> </span><span class="no">c1'</span><span class="w">                                     </span><span class="p">:</span><span class="w"> </span><span class="no">R'</span><span class="w"> </span><span class="mi">0</span><span class="w">     </span><span class="mi">0</span><span class="w">     </span><span class="mi">0</span><span class="w">
  </span><span class="o">|</span><span class="w"> </span><span class="no">c2'</span><span class="w"> </span><span class="no">m</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="no">o</span><span class="w"> </span><span class="o">(</span><span class="no">H</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">R</span><span class="w"> </span><span class="no">m</span><span class="w">     </span><span class="no">n</span><span class="w">     </span><span class="no">o</span><span class="w">        </span><span class="o">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">R'</span><span class="w"> </span><span class="o">(</span><span class="no">S</span><span class="w"> </span><span class="no">m</span><span class="o">)</span><span class="w"> </span><span class="no">n</span><span class="w">     </span><span class="o">(</span><span class="no">S</span><span class="w"> </span><span class="no">o</span><span class="o">)</span><span class="w">
  </span><span class="o">|</span><span class="w"> </span><span class="no">c3'</span><span class="w"> </span><span class="no">m</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="no">o</span><span class="w"> </span><span class="o">(</span><span class="no">H</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">R</span><span class="w"> </span><span class="no">m</span><span class="w">     </span><span class="no">n</span><span class="w">     </span><span class="no">o</span><span class="w">        </span><span class="o">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">R'</span><span class="w"> </span><span class="no">m</span><span class="w">     </span><span class="o">(</span><span class="no">S</span><span class="w"> </span><span class="no">n</span><span class="o">)</span><span class="w"> </span><span class="o">(</span><span class="no">S</span><span class="w"> </span><span class="no">o</span><span class="o">)</span><span class="w">
  </span><span class="o">|</span><span class="w"> </span><span class="no">c4'</span><span class="w"> </span><span class="no">m</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="no">o</span><span class="w"> </span><span class="o">(</span><span class="no">H</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">R</span><span class="w"> </span><span class="o">(</span><span class="no">S</span><span class="w"> </span><span class="no">m</span><span class="o">)</span><span class="w"> </span><span class="o">(</span><span class="no">S</span><span class="w"> </span><span class="no">n</span><span class="o">)</span><span class="w"> </span><span class="o">(</span><span class="no">S</span><span class="w"> </span><span class="o">(</span><span class="no">S</span><span class="w"> </span><span class="no">o</span><span class="o">)))</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">R'</span><span class="w"> </span><span class="no">m</span><span class="w">     </span><span class="no">n</span><span class="w">     </span><span class="no">o</span><span class="w">
</span><span class="o">.</span><span class="w">

</span><span class="c">(* Proof that removing c5 does not change the relation *)</span><span class="w">
</span><span class="k">Theorem</span><span class="w"> </span><span class="no">R_R'_equality</span><span class="p">:</span><span class="w"> </span><span class="kr">forall</span><span class="w"> </span><span class="no">a</span><span class="w"> </span><span class="no">b</span><span class="w"> </span><span class="no">c</span><span class="o">,</span><span class="w"> </span><span class="no">R</span><span class="w"> </span><span class="no">a</span><span class="w"> </span><span class="no">b</span><span class="w"> </span><span class="no">c</span><span class="w"> </span><span class="o">&lt;-&gt;</span><span class="w"> </span><span class="no">R'</span><span class="w"> </span><span class="no">a</span><span class="w"> </span><span class="no">b</span><span class="w"> </span><span class="no">c</span><span class="pi">.</span><span class="w">
</span><span class="k">Proof</span><span class="pi">.</span><span class="w">
  </span><span class="kp">intros</span><span class="pi">.</span><span class="w"> </span><span class="kp">split</span><span class="pi">.</span><span class="w">
  </span><span class="o">{</span><span class="w">
    </span><span class="kp">intros</span><span class="w"> </span><span class="no">H</span><span class="pi">.</span><span class="w"> </span><span class="kp">inversion</span><span class="w"> </span><span class="no">H</span><span class="pi">.</span><span class="w">
    </span><span class="o">-</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">c1'</span><span class="pi">.</span><span class="w">
    </span><span class="o">-</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">c2'</span><span class="o">,</span><span class="w"> </span><span class="no">H0</span><span class="pi">.</span><span class="w">
    </span><span class="o">-</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">c3'</span><span class="o">,</span><span class="w"> </span><span class="no">H0</span><span class="pi">.</span><span class="w">
    </span><span class="o">-</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">c4'</span><span class="o">,</span><span class="w"> </span><span class="no">H0</span><span class="pi">.</span><span class="w">
    </span><span class="o">-</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">c4'</span><span class="o">,</span><span class="w"> </span><span class="no">c2</span><span class="o">,</span><span class="w"> </span><span class="no">c3</span><span class="o">,</span><span class="w"> </span><span class="no">H</span><span class="pi">.</span><span class="w">     
  </span><span class="o">}</span><span class="w">
  </span><span class="o">{</span><span class="w">
    </span><span class="kp">intros</span><span class="w"> </span><span class="no">H</span><span class="pi">.</span><span class="w"> </span><span class="kp">inversion</span><span class="w"> </span><span class="no">H</span><span class="pi">.</span><span class="w">
    </span><span class="o">-</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">c1</span><span class="pi">.</span><span class="w">
    </span><span class="o">-</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">c2</span><span class="o">,</span><span class="w"> </span><span class="no">H0</span><span class="pi">.</span><span class="w">
    </span><span class="o">-</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">c3</span><span class="o">,</span><span class="w"> </span><span class="no">H0</span><span class="pi">.</span><span class="w">
    </span><span class="o">-</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">c4</span><span class="o">,</span><span class="w"> </span><span class="no">H0</span><span class="pi">.</span><span class="w">
  </span><span class="o">}</span><span class="w">
</span><span class="k">Qed</span><span class="pi">.</span><span class="w">
</span></code></pre></div></div>

<h2 id="case-study---regular-expressions">Case Study - Regular Expressions</h2>
<p>A more exciting example for inductive propositions are <a href="https://en.wikipedia.org/wiki/Regular_expression">regular expressions</a>. We can reveal many facts about regular expressions in Coq. The full inductive definition of regular expressions in Coq is somehow too long to exist in this article. Thus, please refer to the original books of Software Foundations<sup id="fnref:1:1" role="doc-noteref"><a href="#fn:1" class="footnote" rel="footnote">2</a></sup>. Here I post my solutions to the exercises:</p>

<p>As a first example, these lemmas examines the definitions of regular expressions:</p>
<ul>
  <li>The expression <code class="language-plaintext highlighter-rouge">EmptySet</code> does not match any string.</li>
  <li>If at lease one of expressions <code class="language-plaintext highlighter-rouge">re1</code> and <code class="language-plaintext highlighter-rouge">re2</code> matches string <code class="language-plaintext highlighter-rouge">s</code>, then <code class="language-plaintext highlighter-rouge">Union re1 re2</code> matches <code class="language-plaintext highlighter-rouge">s</code>.</li>
  <li>If there is a list <code class="language-plaintext highlighter-rouge">l</code> of strings, in which <code class="language-plaintext highlighter-rouge">re</code> matches every string in <code class="language-plaintext highlighter-rouge">l</code> , then <code class="language-plaintext highlighter-rouge">Star re</code> matches the concatenation of <code class="language-plaintext highlighter-rouge">l</code>.</li>
</ul>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">(* Exercise: 3 stars, standard (exp_match_ex1) *)</span><span class="w">
</span><span class="k">Lemma</span><span class="w"> </span><span class="no">empty_is_empty</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">forall</span><span class="w"> </span><span class="no">T</span><span class="w"> </span><span class="o">(</span><span class="no">s</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">list</span><span class="w"> </span><span class="no">T</span><span class="o">),</span><span class="w">
  </span><span class="o">~</span><span class="w"> </span><span class="o">(</span><span class="no">s</span><span class="w"> </span><span class="o">=~</span><span class="w"> </span><span class="no">EmptySet</span><span class="o">).</span><span class="w">
</span><span class="k">Proof</span><span class="pi">.</span><span class="w">
  </span><span class="kp">intros</span><span class="w"> </span><span class="no">T</span><span class="w"> </span><span class="no">s</span><span class="pi">.</span><span class="w"> </span><span class="kp">unfold</span><span class="w"> </span><span class="no">not</span><span class="pi">.</span><span class="w"> </span><span class="kp">destruct</span><span class="w"> </span><span class="no">s</span><span class="pi">.</span><span class="w">
  </span><span class="o">-</span><span class="w"> </span><span class="kp">intros</span><span class="w"> </span><span class="no">H</span><span class="pi">.</span><span class="w"> </span><span class="kp">inversion</span><span class="w"> </span><span class="no">H</span><span class="pi">.</span><span class="w">
  </span><span class="o">-</span><span class="w"> </span><span class="kp">intros</span><span class="w"> </span><span class="no">H</span><span class="pi">.</span><span class="w"> </span><span class="kp">inversion</span><span class="w"> </span><span class="no">H</span><span class="pi">.</span><span class="w">
</span><span class="k">Qed</span><span class="pi">.</span><span class="w">   

</span><span class="k">Lemma</span><span class="w"> </span><span class="no">MUnion'</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">forall</span><span class="w"> </span><span class="no">T</span><span class="w"> </span><span class="o">(</span><span class="no">s</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">list</span><span class="w"> </span><span class="no">T</span><span class="o">)</span><span class="w"> </span><span class="o">(</span><span class="no">re1</span><span class="w"> </span><span class="no">re2</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">reg_exp</span><span class="w"> </span><span class="no">T</span><span class="o">),</span><span class="w">
  </span><span class="no">s</span><span class="w"> </span><span class="o">=~</span><span class="w"> </span><span class="no">re1</span><span class="w"> </span><span class="o">\/</span><span class="w"> </span><span class="no">s</span><span class="w"> </span><span class="o">=~</span><span class="w"> </span><span class="no">re2</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
  </span><span class="no">s</span><span class="w"> </span><span class="o">=~</span><span class="w"> </span><span class="no">Union</span><span class="w"> </span><span class="no">re1</span><span class="w"> </span><span class="no">re2</span><span class="pi">.</span><span class="w">
</span><span class="k">Proof</span><span class="pi">.</span><span class="w">
  </span><span class="kp">intros</span><span class="pi">.</span><span class="w"> </span><span class="kp">destruct</span><span class="w"> </span><span class="no">H</span><span class="pi">.</span><span class="w">
  </span><span class="o">-</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">MUnionL</span><span class="o">,</span><span class="w"> </span><span class="no">H</span><span class="pi">.</span><span class="w">
  </span><span class="o">-</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">MUnionR</span><span class="o">,</span><span class="w"> </span><span class="no">H</span><span class="pi">.</span><span class="w">
</span><span class="k">Qed</span><span class="pi">.</span><span class="w"> 

</span><span class="k">Lemma</span><span class="w"> </span><span class="no">MStar'</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">forall</span><span class="w"> </span><span class="no">T</span><span class="w"> </span><span class="o">(</span><span class="no">ss</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">list</span><span class="w"> </span><span class="o">(</span><span class="no">list</span><span class="w"> </span><span class="no">T</span><span class="o">))</span><span class="w"> </span><span class="o">(</span><span class="no">re</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">reg_exp</span><span class="w"> </span><span class="no">T</span><span class="o">),</span><span class="w">
  </span><span class="o">(</span><span class="kr">forall</span><span class="w"> </span><span class="no">s</span><span class="o">,</span><span class="w"> </span><span class="no">In</span><span class="w"> </span><span class="no">s</span><span class="w"> </span><span class="no">ss</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">s</span><span class="w"> </span><span class="o">=~</span><span class="w"> </span><span class="no">re</span><span class="o">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
  </span><span class="kp">fold</span><span class="w"> </span><span class="no">app</span><span class="w"> </span><span class="no">ss</span><span class="w"> </span><span class="o">[]</span><span class="w"> </span><span class="o">=~</span><span class="w"> </span><span class="no">Star</span><span class="w"> </span><span class="no">re</span><span class="pi">.</span><span class="w">
</span><span class="k">Proof</span><span class="pi">.</span><span class="w">
  </span><span class="kp">intros</span><span class="pi">.</span><span class="w">
  </span><span class="kp">induction</span><span class="w"> </span><span class="no">ss</span><span class="pi">.</span><span class="w">
  </span><span class="o">{</span><span class="w"> </span><span class="kp">simpl</span><span class="pi">.</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">MStar0</span><span class="pi">.</span><span class="w"> </span><span class="o">}</span><span class="w">
  </span><span class="o">{</span><span class="w"> 
    </span><span class="kp">simpl</span><span class="pi">.</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">MStarApp</span><span class="pi">.</span><span class="w">
    </span><span class="o">-</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">H</span><span class="pi">.</span><span class="w"> </span><span class="kp">simpl</span><span class="pi">.</span><span class="w"> </span><span class="no">left</span><span class="pi">.</span><span class="w"> </span><span class="ne">reflexivity</span><span class="pi">.</span><span class="w">
    </span><span class="o">-</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">IHss</span><span class="pi">.</span><span class="w"> </span><span class="kp">intros</span><span class="pi">.</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">H</span><span class="pi">.</span><span class="w"> </span><span class="kp">simpl</span><span class="pi">.</span><span class="w"> </span><span class="no">right</span><span class="pi">.</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">H0</span><span class="pi">.</span><span class="w">
  </span><span class="o">}</span><span class="w">
</span><span class="k">Qed</span><span class="pi">.</span><span class="w">
</span></code></pre></div></div>

<p>Write a recursive function <code class="language-plaintext highlighter-rouge">re_not_empty</code> that tests whether a regular expression matches some string. Prove that your function is correct.</p>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">(** Exercise: 4 stars, standard (re_not_empty)*)</span><span class="w">

</span><span class="k">Fixpoint</span><span class="w"> </span><span class="no">re_not_empty</span><span class="w"> </span><span class="o">{</span><span class="no">T</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">Type</span><span class="o">}</span><span class="w"> </span><span class="o">(</span><span class="no">re</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">reg_exp</span><span class="w"> </span><span class="no">T</span><span class="o">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">bool</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w">
  </span><span class="kr">match</span><span class="w"> </span><span class="no">re</span><span class="w"> </span><span class="kp">with</span><span class="w">
    </span><span class="o">|</span><span class="w"> </span><span class="no">EmptySet</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="no">false</span><span class="w">
    </span><span class="o">|</span><span class="w"> </span><span class="no">EmptyStr</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="no">true</span><span class="w">
    </span><span class="o">|</span><span class="w"> </span><span class="no">Char</span><span class="w"> </span><span class="no">x</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="no">true</span><span class="w">
    </span><span class="o">|</span><span class="w"> </span><span class="no">App</span><span class="w"> </span><span class="no">r1</span><span class="w"> </span><span class="no">r2</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">(</span><span class="no">re_not_empty</span><span class="w"> </span><span class="no">r1</span><span class="o">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">(</span><span class="no">re_not_empty</span><span class="w"> </span><span class="no">r2</span><span class="o">)</span><span class="w">
    </span><span class="o">|</span><span class="w"> </span><span class="no">Union</span><span class="w"> </span><span class="no">r1</span><span class="w"> </span><span class="no">r2</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">(</span><span class="no">re_not_empty</span><span class="w"> </span><span class="no">r1</span><span class="o">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">(</span><span class="no">re_not_empty</span><span class="w"> </span><span class="no">r2</span><span class="o">)</span><span class="w">
    </span><span class="o">|</span><span class="w"> </span><span class="no">Star</span><span class="w"> </span><span class="no">r</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="no">true</span><span class="w"> </span><span class="c">(* note that `Star` always matches empty string [] *)</span><span class="w">
  </span><span class="kr">end</span><span class="pi">.</span><span class="w">

</span><span class="k">Lemma</span><span class="w"> </span><span class="no">re_not_empty_correct</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">forall</span><span class="w"> </span><span class="no">T</span><span class="w"> </span><span class="o">(</span><span class="no">re</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">reg_exp</span><span class="w"> </span><span class="no">T</span><span class="o">),</span><span class="w">
	</span><span class="o">(</span><span class="kp">exists</span><span class="w"> </span><span class="no">s</span><span class="o">,</span><span class="w"> </span><span class="no">s</span><span class="w"> </span><span class="o">=~</span><span class="w"> </span><span class="no">re</span><span class="o">)</span><span class="w"> </span><span class="o">&lt;-&gt;</span><span class="w"> </span><span class="no">re_not_empty</span><span class="w"> </span><span class="no">re</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="pi">.</span><span class="w">
</span><span class="k">Proof</span><span class="pi">.</span><span class="w">
  </span><span class="kp">intros</span><span class="w"> </span><span class="no">T</span><span class="w"> </span><span class="no">re</span><span class="pi">.</span><span class="w">
  </span><span class="kp">split</span><span class="pi">.</span><span class="w">
  </span><span class="o">{</span><span class="w"> 
    </span><span class="c">(* exists -&gt; not empty *)</span><span class="w">
    </span><span class="kp">intros</span><span class="w"> </span><span class="no">Hexists</span><span class="pi">.</span><span class="w">
    </span><span class="kp">destruct</span><span class="w"> </span><span class="no">Hexists</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="o">[</span><span class="no">x</span><span class="w"> </span><span class="no">H</span><span class="o">].</span><span class="w">
    </span><span class="kp">induction</span><span class="w"> </span><span class="no">H</span><span class="pi">.</span><span class="w">
    </span><span class="o">-</span><span class="w"> </span><span class="ne">reflexivity</span><span class="pi">.</span><span class="w">
    </span><span class="o">-</span><span class="w"> </span><span class="ne">reflexivity</span><span class="pi">.</span><span class="w">
    </span><span class="o">-</span><span class="w"> </span><span class="kp">simpl</span><span class="pi">.</span><span class="w"> </span><span class="kp">rewrite</span><span class="w"> </span><span class="no">IHexp_match1</span><span class="pi">.</span><span class="w"> </span><span class="kp">rewrite</span><span class="w"> </span><span class="no">IHexp_match2</span><span class="pi">.</span><span class="w"> </span><span class="ne">reflexivity</span><span class="pi">.</span><span class="w">
    </span><span class="o">-</span><span class="w"> </span><span class="kp">simpl</span><span class="pi">.</span><span class="w"> </span><span class="kp">rewrite</span><span class="w"> </span><span class="no">IHexp_match</span><span class="pi">.</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">orb_true_iff</span><span class="pi">.</span><span class="w"> </span><span class="no">left</span><span class="pi">.</span><span class="w"> </span><span class="ne">reflexivity</span><span class="pi">.</span><span class="w">
    </span><span class="o">-</span><span class="w"> </span><span class="kp">simpl</span><span class="pi">.</span><span class="w"> </span><span class="kp">rewrite</span><span class="w"> </span><span class="no">IHexp_match</span><span class="pi">.</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">orb_true_iff</span><span class="pi">.</span><span class="w"> </span><span class="no">right</span><span class="pi">.</span><span class="w"> </span><span class="ne">reflexivity</span><span class="pi">.</span><span class="w">
    </span><span class="o">-</span><span class="w"> </span><span class="ne">reflexivity</span><span class="pi">.</span><span class="w">
    </span><span class="o">-</span><span class="w"> </span><span class="ne">reflexivity</span><span class="pi">.</span><span class="w">
  </span><span class="o">}</span><span class="w">
  </span><span class="o">{</span><span class="w">
    </span><span class="c">(* not empty -&gt; exists *)</span><span class="w">
    </span><span class="kp">intros</span><span class="w"> </span><span class="no">H</span><span class="pi">.</span><span class="w">
    </span><span class="kp">induction</span><span class="w"> </span><span class="no">re</span><span class="pi">.</span><span class="w">
    </span><span class="o">-</span><span class="w"> </span><span class="no">discriminate</span><span class="w"> </span><span class="no">H</span><span class="pi">.</span><span class="w">
    </span><span class="o">-</span><span class="w"> </span><span class="kp">exists</span><span class="w"> </span><span class="o">[].</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">MEmpty</span><span class="pi">.</span><span class="w">
    </span><span class="o">-</span><span class="w"> </span><span class="kp">exists</span><span class="w"> </span><span class="o">[</span><span class="no">t</span><span class="o">].</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">MChar</span><span class="pi">.</span><span class="w">
    </span><span class="o">-</span><span class="w"> </span><span class="kp">simpl</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="no">H</span><span class="pi">.</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">andb_true_iff</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="no">H</span><span class="pi">.</span><span class="w"> </span><span class="kp">destruct</span><span class="w"> </span><span class="no">H</span><span class="pi">.</span><span class="w">
      </span><span class="kp">apply</span><span class="w"> </span><span class="no">IHre1</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="no">H</span><span class="pi">.</span><span class="w"> </span><span class="kp">destruct</span><span class="w"> </span><span class="no">H</span><span class="pi">.</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">IHre2</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="no">H0</span><span class="pi">.</span><span class="w"> </span><span class="kp">destruct</span><span class="w"> </span><span class="no">H0</span><span class="pi">.</span><span class="w">
      </span><span class="kp">exists</span><span class="w"> </span><span class="o">(</span><span class="no">x</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="no">x0</span><span class="o">).</span><span class="w">
      </span><span class="kp">apply</span><span class="w"> </span><span class="no">MApp</span><span class="pi">.</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">H</span><span class="pi">.</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">H0</span><span class="pi">.</span><span class="w">
    </span><span class="o">-</span><span class="w"> </span><span class="kp">simpl</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="no">H</span><span class="pi">.</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">orb_true_iff</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="no">H</span><span class="pi">.</span><span class="w"> </span><span class="kp">destruct</span><span class="w"> </span><span class="no">H</span><span class="pi">.</span><span class="w">
      </span><span class="o">+</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">IHre1</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="no">H</span><span class="pi">.</span><span class="w"> </span><span class="kp">destruct</span><span class="w"> </span><span class="no">H</span><span class="pi">.</span><span class="w">
        </span><span class="kp">exists</span><span class="w"> </span><span class="no">x</span><span class="pi">.</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">MUnionL</span><span class="o">,</span><span class="w"> </span><span class="no">H</span><span class="pi">.</span><span class="w">
      </span><span class="o">+</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">IHre2</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="no">H</span><span class="pi">.</span><span class="w"> </span><span class="kp">destruct</span><span class="w"> </span><span class="no">H</span><span class="pi">.</span><span class="w">
        </span><span class="kp">exists</span><span class="w"> </span><span class="no">x</span><span class="pi">.</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">MUnionR</span><span class="o">,</span><span class="w"> </span><span class="no">H</span><span class="pi">.</span><span class="w">
    </span><span class="o">-</span><span class="w"> </span><span class="kp">exists</span><span class="w"> </span><span class="o">[].</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">MStar0</span><span class="pi">.</span><span class="w">
  </span><span class="o">}</span><span class="w">
</span><span class="k">Qed</span><span class="pi">.</span><span class="w">
</span></code></pre></div></div>

<h2 id="case-study-reflection">Case Study: Reflection</h2>
<p>A <em>reflection</em> is a corresponding boolean expression to a proposition. Having a reflection implies the proposition is decidable as a boolean expression can be calculated in a deterministic process within finite steps. A naive reminder:</p>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">(</span><span class="no">n</span><span class="w"> </span><span class="o">=?</span><span class="w"> </span><span class="no">m</span><span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"> </span><span class="o">&lt;-&gt;</span><span class="w"> </span><span class="no">m</span><span class="o">=</span><span class="no">n</span><span class="w">
</span></code></pre></div></div>

<p>There are many propositions that have reflections. As an abstraction, the “reflection principle” can be defined as:</p>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Inductive</span><span class="w"> </span><span class="no">reflect</span><span class="w"> </span><span class="o">(</span><span class="no">P</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">Prop</span><span class="o">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">bool</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kr">Prop</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w">
  </span><span class="o">|</span><span class="w"> </span><span class="no">ReflectT</span><span class="w"> </span><span class="o">(</span><span class="no">H</span><span class="w"> </span><span class="p">:</span><span class="w">   </span><span class="no">P</span><span class="o">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">reflect</span><span class="w"> </span><span class="no">P</span><span class="w"> </span><span class="no">true</span><span class="w">
  </span><span class="o">|</span><span class="w"> </span><span class="no">ReflectF</span><span class="w"> </span><span class="o">(</span><span class="no">H</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="no">P</span><span class="o">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">reflect</span><span class="w"> </span><span class="no">P</span><span class="w"> </span><span class="no">false</span><span class="pi">.</span><span class="w">
</span></code></pre></div></div>
<p>The relation <code class="language-plaintext highlighter-rouge">reflect</code> takes two arguments, a proposition P and a boolean b. It states that P reflects the boolean b, that is, P holds if and only if b is true. An advantage of having such abstraction is that we can perform case analysis while at the same time generate appropriate hypothesis.</p>

<p>First we show a reflection relation between <code class="language-plaintext highlighter-rouge">=?</code> and <code class="language-plaintext highlighter-rouge">=</code></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Lemma eqbP : forall n m, reflect (n = m) (n =? m).
Proof.
  intros n m. apply iff_reflect. rewrite eqb_eq. reflexivity.
Qed.   
</code></pre></div></div>

<p>Then we can use it in case analysis. When we go into the branch that <code class="language-plaintext highlighter-rouge">n=?m</code> is true, we get the hypothesis <code class="language-plaintext highlighter-rouge">n=m</code> automatically. This is a small gain in convenience.</p>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">(** Exercise: 3 stars, standard, especially useful (eqbP_practice) *)</span><span class="w">
</span><span class="k">Fixpoint</span><span class="w"> </span><span class="no">count</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="no">l</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w">
  </span><span class="kr">match</span><span class="w"> </span><span class="no">l</span><span class="w"> </span><span class="kp">with</span><span class="w">
  </span><span class="o">|</span><span class="w"> </span><span class="o">[]</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w">
  </span><span class="o">|</span><span class="w"> </span><span class="no">m</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="no">l'</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">(</span><span class="kr">if</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="o">=?</span><span class="w"> </span><span class="no">m</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="kr">else</span><span class="w"> </span><span class="mi">0</span><span class="o">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="no">count</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="no">l'</span><span class="w">
  </span><span class="kr">end</span><span class="pi">.</span><span class="w">

</span><span class="k">Theorem</span><span class="w"> </span><span class="no">eqbP_practice</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">forall</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="no">l</span><span class="o">,</span><span class="w">
  </span><span class="no">count</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="no">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">~(</span><span class="no">In</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="no">l</span><span class="o">).</span><span class="w">
</span><span class="k">Proof</span><span class="pi">.</span><span class="w">
  </span><span class="kp">intros</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="no">l</span><span class="w"> </span><span class="no">Hcount</span><span class="pi">.</span><span class="w"> </span><span class="kp">induction</span><span class="w"> </span><span class="no">l</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="o">[|</span><span class="w"> </span><span class="no">m</span><span class="w"> </span><span class="no">l'</span><span class="w"> </span><span class="no">IHl'</span><span class="o">].</span><span class="w">
  </span><span class="o">-</span><span class="w"> </span><span class="kp">unfold</span><span class="w"> </span><span class="no">not</span><span class="pi">.</span><span class="w"> </span><span class="no">trivial</span><span class="pi">.</span><span class="w">
  </span><span class="o">-</span><span class="w"> </span><span class="kp">simpl</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="o">*.</span><span class="w"> </span><span class="kp">destruct</span><span class="w"> </span><span class="o">(</span><span class="no">eqbP</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="no">m</span><span class="o">)</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="o">[</span><span class="no">H0</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="no">H0</span><span class="o">].</span><span class="w">
    </span><span class="o">+</span><span class="w"> </span><span class="no">discriminate</span><span class="w"> </span><span class="no">Hcount</span><span class="pi">.</span><span class="w"> 
    </span><span class="o">+</span><span class="w"> </span><span class="kp">simpl</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="o">*.</span><span class="w"> </span><span class="kp">intros</span><span class="w"> </span><span class="o">[</span><span class="no">H</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="no">H</span><span class="o">].</span><span class="w">
      </span><span class="o">*</span><span class="w"> </span><span class="kp">unfold</span><span class="w"> </span><span class="no">not</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="no">H0</span><span class="pi">.</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">H0</span><span class="pi">.</span><span class="w"> </span><span class="kp">rewrite</span><span class="w"> </span><span class="no">H</span><span class="pi">.</span><span class="w"> </span><span class="ne">reflexivity</span><span class="pi">.</span><span class="w"> 
      </span><span class="o">*</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">IHl'</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="no">Hcount</span><span class="pi">.</span><span class="w"> </span><span class="kp">exfalso</span><span class="pi">.</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">Hcount</span><span class="pi">.</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="no">H</span><span class="pi">.</span><span class="w">
</span><span class="k">Qed</span><span class="pi">.</span><span class="w">   
</span></code></pre></div></div>

<h2 id="reference">Reference</h2>

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:2" role="doc-endnote">
      <p>Decidability (logic). (2023). Retrieved from https://en.wikipedia.org/wiki/Decidability_(logic) <a href="#fnref:2" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:1" role="doc-endnote">
      <p>IndPropInductively Defined Propositions. (n.d.). Retrieved from https://softwarefoundations.cis.upenn.edu/lf-current/IndProp.html <a href="#fnref:1" class="reversefootnote" role="doc-backlink">&#8617;</a> <a href="#fnref:1:1" class="reversefootnote" role="doc-backlink">&#8617;<sup>2</sup></a></p>
    </li>
    <li id="fn:3" role="doc-endnote">
      <p>Collatz conjecture. (2023). Retrieved from https://en.wikipedia.org/wiki/Collatz_conjecture <a href="#fnref:3" class="reversefootnote" role="doc-backlink">&#8617;</a> <a href="#fnref:3:1" class="reversefootnote" role="doc-backlink">&#8617;<sup>2</sup></a> <a href="#fnref:3:2" class="reversefootnote" role="doc-backlink">&#8617;<sup>3</sup></a></p>
    </li>
  </ol>
</div>

  </div><a class="u-url" href="/software-foundations/2023/12/10/Inductive-Propositions.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    
    <div class="footer-col-wrapper">
      <div class="footer-col">
        <h2 class="footer-heading">Chew&#39;s Everyday Blog</h2>By wisdom a house is built, and through understanding it is established.</div>
      <div class="footer-col">
        <ul class="contact-list">
          <li class="p-name">Author: Chew Y. Feng</li><li>
              <span>
                Mail: 
              </span>
            <a class="u-email" href="mailto:chew.y.feng@outlook.com">chew.y.feng@outlook.com</a></li><div>
              Find me:<ul class="social-media-list"><li><a href="https://github.com/excitedspider"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">excitedspider</span></a></li><li><a href="https://www.linkedin.com/in/qiuyi-feng-348968287"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#linkedin"></use></svg> <span class="username">qiuyi-feng-348968287</span></a></li></ul>
</div>
            <div class="footer-col-rss">
              <p class="rss-subscribe">subscribe <a href="/feed.xml">via RSS</a></p>
            </div>
        </ul>
      </div>

    </div>

  </div>

</footer>
</body>

</html>
